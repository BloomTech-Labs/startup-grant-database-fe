{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.requestPasswordlessEmail = requestPasswordlessEmail;\nexports.requestPasswordlessEmailSuccess = requestPasswordlessEmailSuccess;\nexports.requestPasswordlessEmailError = requestPasswordlessEmailError;\nexports.resendEmail = resendEmail;\nexports.sendSMS = sendSMS;\nexports.logIn = logIn;\nexports.restart = restart;\nexports.toggleTermsAcceptance = toggleTermsAcceptance;\n\nvar _immutable = require('immutable');\n\nvar _index = require('../../store/index');\n\nvar _actions = require('../../core/actions');\n\nvar _web_api = require('../../core/web_api');\n\nvar _web_api2 = _interopRequireDefault(_web_api);\n\nvar _index2 = require('../../field/index');\n\nvar c = _interopRequireWildcard(_index2);\n\nvar _index3 = require('../../core/index');\n\nvar l = _interopRequireWildcard(_index3);\n\nvar _index4 = require('./index');\n\nvar _phone_number = require('../../field/phone_number');\n\nvar _i18n = require('../../i18n');\n\nvar i18n = _interopRequireWildcard(_i18n);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction getErrorMessage(m, error) {\n  var key = error.error;\n\n  if (error.error === 'sms_provider_error' && (error.description || '').indexOf('(Code: 21211)') > -1) {\n    key = 'bad.phone_number';\n  }\n\n  return i18n.html(m, ['error', 'passwordless', key]) || i18n.html(m, ['error', 'passwordless', 'lock.fallback']);\n}\n\nfunction requestPasswordlessEmail(id) {\n  (0, _actions.validateAndSubmit)(id, ['email'], function (m) {\n    sendEmail(m, requestPasswordlessEmailSuccess, requestPasswordlessEmailError);\n  });\n}\n\nfunction requestPasswordlessEmailSuccess(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    m = l.setSubmitting(m, false);\n    return (0, _index4.setPasswordlessStarted)(m, true);\n  });\n}\n\nfunction requestPasswordlessEmailError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var errorMessage = getErrorMessage(m, error);\n  return (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n}\n\nfunction resendEmail(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.resend);\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  sendEmail(m, resendEmailSuccess, resendEmailError);\n}\n\nfunction resendEmailSuccess(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setResendSuccess);\n}\n\nfunction resendEmailError(id, error) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setResendFailed);\n}\n\nfunction sendEmail(m, successFn, errorFn) {\n  var params = {\n    connection: 'email',\n    email: c.getFieldValue(m, 'email'),\n    send: (0, _index4.send)(m)\n  };\n\n  if ((0, _index4.isSendLink)(m) && !l.auth.params(m).isEmpty()) {\n    params.authParams = l.auth.params(m).toJS();\n  }\n\n  _web_api2.default.startPasswordless(l.id(m), params, function (error) {\n    if (error) {\n      setTimeout(function () {\n        return errorFn(l.id(m), error);\n      }, 250);\n    } else {\n      successFn(l.id(m));\n    }\n  });\n}\n\nfunction sendSMS(id) {\n  (0, _actions.validateAndSubmit)(id, ['phoneNumber'], function (m) {\n    var params = {\n      connection: 'sms',\n      phoneNumber: (0, _phone_number.phoneNumberWithDiallingCode)(m),\n      send: (0, _index4.send)(m)\n    };\n\n    _web_api2.default.startPasswordless(id, params, function (error) {\n      if (error) {\n        setTimeout(function () {\n          return sendSMSError(id, error);\n        }, 250);\n      } else {\n        sendSMSSuccess(id);\n      }\n    });\n  });\n}\n\nfunction sendSMSSuccess(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    m = l.setSubmitting(m, false);\n    m = (0, _index4.setPasswordlessStarted)(m, true);\n    return m;\n  });\n}\n\nfunction sendSMSError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var errorMessage = getErrorMessage(m, error);\n  return (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n}\n\nfunction logIn(id) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var authParams = l.auth.params(m).toJS();\n\n  var params = _extends({\n    verificationCode: c.getFieldValue(m, 'vcode')\n  }, authParams);\n\n  if ((0, _index4.isEmail)(m)) {\n    params.connection = 'email';\n    params.email = c.getFieldValue(m, 'email');\n  } else {\n    params.connection = 'sms';\n    params.phoneNumber = (0, _phone_number.phoneNumberWithDiallingCode)(m);\n  }\n\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, true);\n\n  _web_api2.default.passwordlessVerify(id, params, function (error, result) {\n    var errorMessage = void 0;\n\n    if (error) {\n      var _m = (0, _index.read)(_index.getEntity, 'lock', id);\n\n      errorMessage = getErrorMessage(_m, error);\n\n      if (error.logToConsole) {\n        console.error(error.description);\n      }\n\n      l.emitAuthorizationErrorEvent(_m, error);\n      return (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n    } else {\n      return (0, _actions.logInSuccess)(id, result);\n    }\n  });\n}\n\nfunction restart(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.restartPasswordless);\n}\n\nfunction toggleTermsAcceptance(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.toggleTermsAcceptance);\n}","map":{"version":3,"sources":["/Users/jacksonmccomas/Documents/Lambda/labs/startup-grant-database-fe/grantly/node_modules/auth0-lock/lib/connection/passwordless/actions.js"],"names":["exports","__esModule","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","requestPasswordlessEmail","requestPasswordlessEmailSuccess","requestPasswordlessEmailError","resendEmail","sendSMS","logIn","restart","toggleTermsAcceptance","_immutable","require","_index","_actions","_web_api","_web_api2","_interopRequireDefault","_index2","c","_interopRequireWildcard","_index3","l","_index4","_phone_number","_i18n","i18n","obj","newObj","default","getErrorMessage","m","error","description","indexOf","html","id","validateAndSubmit","sendEmail","swap","updateEntity","setSubmitting","setPasswordlessStarted","read","getEntity","errorMessage","resend","resendEmailSuccess","resendEmailError","setResendSuccess","setResendFailed","successFn","errorFn","params","connection","email","getFieldValue","send","isSendLink","auth","isEmpty","authParams","toJS","startPasswordless","setTimeout","phoneNumber","phoneNumberWithDiallingCode","sendSMSError","sendSMSSuccess","verificationCode","isEmail","passwordlessVerify","result","_m","logToConsole","console","emitAuthorizationErrorEvent","logInSuccess","restartPasswordless"],"mappings":"AAAA;;AAEAA,OAAO,CAACC,UAAR,GAAqB,IAArB;;AAEA,IAAIC,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAAUC,MAAV,EAAkB;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAtB;;AAA2B,SAAK,IAAII,GAAT,IAAgBD,MAAhB,EAAwB;AAAE,UAAIN,MAAM,CAACQ,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,MAArC,EAA6CC,GAA7C,CAAJ,EAAuD;AAAEL,QAAAA,MAAM,CAACK,GAAD,CAAN,GAAcD,MAAM,CAACC,GAAD,CAApB;AAA4B;AAAE;AAAE;;AAAC,SAAOL,MAAP;AAAgB,CAAhQ;;AAEAL,OAAO,CAACc,wBAAR,GAAmCA,wBAAnC;AACAd,OAAO,CAACe,+BAAR,GAA0CA,+BAA1C;AACAf,OAAO,CAACgB,6BAAR,GAAwCA,6BAAxC;AACAhB,OAAO,CAACiB,WAAR,GAAsBA,WAAtB;AACAjB,OAAO,CAACkB,OAAR,GAAkBA,OAAlB;AACAlB,OAAO,CAACmB,KAAR,GAAgBA,KAAhB;AACAnB,OAAO,CAACoB,OAAR,GAAkBA,OAAlB;AACApB,OAAO,CAACqB,qBAAR,GAAgCA,qBAAhC;;AAEA,IAAIC,UAAU,GAAGC,OAAO,CAAC,WAAD,CAAxB;;AAEA,IAAIC,MAAM,GAAGD,OAAO,CAAC,mBAAD,CAApB;;AAEA,IAAIE,QAAQ,GAAGF,OAAO,CAAC,oBAAD,CAAtB;;AAEA,IAAIG,QAAQ,GAAGH,OAAO,CAAC,oBAAD,CAAtB;;AAEA,IAAII,SAAS,GAAGC,sBAAsB,CAACF,QAAD,CAAtC;;AAEA,IAAIG,OAAO,GAAGN,OAAO,CAAC,mBAAD,CAArB;;AAEA,IAAIO,CAAC,GAAGC,uBAAuB,CAACF,OAAD,CAA/B;;AAEA,IAAIG,OAAO,GAAGT,OAAO,CAAC,kBAAD,CAArB;;AAEA,IAAIU,CAAC,GAAGF,uBAAuB,CAACC,OAAD,CAA/B;;AAEA,IAAIE,OAAO,GAAGX,OAAO,CAAC,SAAD,CAArB;;AAEA,IAAIY,aAAa,GAAGZ,OAAO,CAAC,0BAAD,CAA3B;;AAEA,IAAIa,KAAK,GAAGb,OAAO,CAAC,YAAD,CAAnB;;AAEA,IAAIc,IAAI,GAAGN,uBAAuB,CAACK,KAAD,CAAlC;;AAEA,SAASL,uBAAT,CAAiCO,GAAjC,EAAsC;AAAE,MAAIA,GAAG,IAAIA,GAAG,CAACrC,UAAf,EAA2B;AAAE,WAAOqC,GAAP;AAAa,GAA1C,MAAgD;AAAE,QAAIC,MAAM,GAAG,EAAb;;AAAiB,QAAID,GAAG,IAAI,IAAX,EAAiB;AAAE,WAAK,IAAI5B,GAAT,IAAgB4B,GAAhB,EAAqB;AAAE,YAAInC,MAAM,CAACQ,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCyB,GAArC,EAA0C5B,GAA1C,CAAJ,EAAoD6B,MAAM,CAAC7B,GAAD,CAAN,GAAc4B,GAAG,CAAC5B,GAAD,CAAjB;AAAyB;AAAE;;AAAC6B,IAAAA,MAAM,CAACC,OAAP,GAAiBF,GAAjB;AAAsB,WAAOC,MAAP;AAAgB;AAAE;;AAE7Q,SAASX,sBAAT,CAAgCU,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACrC,UAAX,GAAwBqC,GAAxB,GAA8B;AAAEE,IAAAA,OAAO,EAAEF;AAAX,GAArC;AAAwD;;AAE/F,SAASG,eAAT,CAAyBC,CAAzB,EAA4BC,KAA5B,EAAmC;AACjC,MAAIjC,GAAG,GAAGiC,KAAK,CAACA,KAAhB;;AAEA,MAAIA,KAAK,CAACA,KAAN,KAAgB,oBAAhB,IAAwC,CAACA,KAAK,CAACC,WAAN,IAAqB,EAAtB,EAA0BC,OAA1B,CAAkC,eAAlC,IAAqD,CAAC,CAAlG,EAAqG;AACnGnC,IAAAA,GAAG,GAAG,kBAAN;AACD;;AAED,SAAO2B,IAAI,CAACS,IAAL,CAAUJ,CAAV,EAAa,CAAC,OAAD,EAAU,cAAV,EAA0BhC,GAA1B,CAAb,KAAgD2B,IAAI,CAACS,IAAL,CAAUJ,CAAV,EAAa,CAAC,OAAD,EAAU,cAAV,EAA0B,eAA1B,CAAb,CAAvD;AACD;;AAED,SAAS5B,wBAAT,CAAkCiC,EAAlC,EAAsC;AACpC,GAAC,GAAGtB,QAAQ,CAACuB,iBAAb,EAAgCD,EAAhC,EAAoC,CAAC,OAAD,CAApC,EAA+C,UAAUL,CAAV,EAAa;AAC1DO,IAAAA,SAAS,CAACP,CAAD,EAAI3B,+BAAJ,EAAqCC,6BAArC,CAAT;AACD,GAFD;AAGD;;AAED,SAASD,+BAAT,CAAyCgC,EAAzC,EAA6C;AAC3C,GAAC,GAAGvB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkD,UAAUL,CAAV,EAAa;AAC7DA,IAAAA,CAAC,GAAGT,CAAC,CAACmB,aAAF,CAAgBV,CAAhB,EAAmB,KAAnB,CAAJ;AACA,WAAO,CAAC,GAAGR,OAAO,CAACmB,sBAAZ,EAAoCX,CAApC,EAAuC,IAAvC,CAAP;AACD,GAHD;AAID;;AAED,SAAS1B,6BAAT,CAAuC+B,EAAvC,EAA2CJ,KAA3C,EAAkD;AAChD,MAAID,CAAC,GAAG,CAAC,GAAGlB,MAAM,CAAC8B,IAAX,EAAiB9B,MAAM,CAAC+B,SAAxB,EAAmC,MAAnC,EAA2CR,EAA3C,CAAR;AACA,MAAIS,YAAY,GAAGf,eAAe,CAACC,CAAD,EAAIC,KAAJ,CAAlC;AACA,SAAO,CAAC,GAAGnB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDd,CAAC,CAACmB,aAApD,EAAmE,KAAnE,EAA0EI,YAA1E,CAAP;AACD;;AAED,SAASvC,WAAT,CAAqB8B,EAArB,EAAyB;AACvB,GAAC,GAAGvB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDb,OAAO,CAACuB,MAA1D;AACA,MAAIf,CAAC,GAAG,CAAC,GAAGlB,MAAM,CAAC8B,IAAX,EAAiB9B,MAAM,CAAC+B,SAAxB,EAAmC,MAAnC,EAA2CR,EAA3C,CAAR;AACAE,EAAAA,SAAS,CAACP,CAAD,EAAIgB,kBAAJ,EAAwBC,gBAAxB,CAAT;AACD;;AAED,SAASD,kBAAT,CAA4BX,EAA5B,EAAgC;AAC9B,GAAC,GAAGvB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDb,OAAO,CAAC0B,gBAA1D;AACD;;AAED,SAASD,gBAAT,CAA0BZ,EAA1B,EAA8BJ,KAA9B,EAAqC;AACnC,GAAC,GAAGnB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDb,OAAO,CAAC2B,eAA1D;AACD;;AAED,SAASZ,SAAT,CAAmBP,CAAnB,EAAsBoB,SAAtB,EAAiCC,OAAjC,EAA0C;AACxC,MAAIC,MAAM,GAAG;AACXC,IAAAA,UAAU,EAAE,OADD;AAEXC,IAAAA,KAAK,EAAEpC,CAAC,CAACqC,aAAF,CAAgBzB,CAAhB,EAAmB,OAAnB,CAFI;AAGX0B,IAAAA,IAAI,EAAE,CAAC,GAAGlC,OAAO,CAACkC,IAAZ,EAAkB1B,CAAlB;AAHK,GAAb;;AAMA,MAAI,CAAC,GAAGR,OAAO,CAACmC,UAAZ,EAAwB3B,CAAxB,KAA8B,CAACT,CAAC,CAACqC,IAAF,CAAON,MAAP,CAActB,CAAd,EAAiB6B,OAAjB,EAAnC,EAA+D;AAC7DP,IAAAA,MAAM,CAACQ,UAAP,GAAoBvC,CAAC,CAACqC,IAAF,CAAON,MAAP,CAActB,CAAd,EAAiB+B,IAAjB,EAApB;AACD;;AAED9C,EAAAA,SAAS,CAACa,OAAV,CAAkBkC,iBAAlB,CAAoCzC,CAAC,CAACc,EAAF,CAAKL,CAAL,CAApC,EAA6CsB,MAA7C,EAAqD,UAAUrB,KAAV,EAAiB;AACpE,QAAIA,KAAJ,EAAW;AACTgC,MAAAA,UAAU,CAAC,YAAY;AACrB,eAAOZ,OAAO,CAAC9B,CAAC,CAACc,EAAF,CAAKL,CAAL,CAAD,EAAUC,KAAV,CAAd;AACD,OAFS,EAEP,GAFO,CAAV;AAGD,KAJD,MAIO;AACLmB,MAAAA,SAAS,CAAC7B,CAAC,CAACc,EAAF,CAAKL,CAAL,CAAD,CAAT;AACD;AACF,GARD;AASD;;AAED,SAASxB,OAAT,CAAiB6B,EAAjB,EAAqB;AACnB,GAAC,GAAGtB,QAAQ,CAACuB,iBAAb,EAAgCD,EAAhC,EAAoC,CAAC,aAAD,CAApC,EAAqD,UAAUL,CAAV,EAAa;AAChE,QAAIsB,MAAM,GAAG;AACXC,MAAAA,UAAU,EAAE,KADD;AAEXW,MAAAA,WAAW,EAAE,CAAC,GAAGzC,aAAa,CAAC0C,2BAAlB,EAA+CnC,CAA/C,CAFF;AAGX0B,MAAAA,IAAI,EAAE,CAAC,GAAGlC,OAAO,CAACkC,IAAZ,EAAkB1B,CAAlB;AAHK,KAAb;;AAKAf,IAAAA,SAAS,CAACa,OAAV,CAAkBkC,iBAAlB,CAAoC3B,EAApC,EAAwCiB,MAAxC,EAAgD,UAAUrB,KAAV,EAAiB;AAC/D,UAAIA,KAAJ,EAAW;AACTgC,QAAAA,UAAU,CAAC,YAAY;AACrB,iBAAOG,YAAY,CAAC/B,EAAD,EAAKJ,KAAL,CAAnB;AACD,SAFS,EAEP,GAFO,CAAV;AAGD,OAJD,MAIO;AACLoC,QAAAA,cAAc,CAAChC,EAAD,CAAd;AACD;AACF,KARD;AASD,GAfD;AAgBD;;AAED,SAASgC,cAAT,CAAwBhC,EAAxB,EAA4B;AAC1B,GAAC,GAAGvB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkD,UAAUL,CAAV,EAAa;AAC7DA,IAAAA,CAAC,GAAGT,CAAC,CAACmB,aAAF,CAAgBV,CAAhB,EAAmB,KAAnB,CAAJ;AACAA,IAAAA,CAAC,GAAG,CAAC,GAAGR,OAAO,CAACmB,sBAAZ,EAAoCX,CAApC,EAAuC,IAAvC,CAAJ;AACA,WAAOA,CAAP;AACD,GAJD;AAKD;;AAED,SAASoC,YAAT,CAAsB/B,EAAtB,EAA0BJ,KAA1B,EAAiC;AAC/B,MAAID,CAAC,GAAG,CAAC,GAAGlB,MAAM,CAAC8B,IAAX,EAAiB9B,MAAM,CAAC+B,SAAxB,EAAmC,MAAnC,EAA2CR,EAA3C,CAAR;AACA,MAAIS,YAAY,GAAGf,eAAe,CAACC,CAAD,EAAIC,KAAJ,CAAlC;AACA,SAAO,CAAC,GAAGnB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDd,CAAC,CAACmB,aAApD,EAAmE,KAAnE,EAA0EI,YAA1E,CAAP;AACD;;AAED,SAASrC,KAAT,CAAe4B,EAAf,EAAmB;AACjB,MAAIL,CAAC,GAAG,CAAC,GAAGlB,MAAM,CAAC8B,IAAX,EAAiB9B,MAAM,CAAC+B,SAAxB,EAAmC,MAAnC,EAA2CR,EAA3C,CAAR;AACA,MAAIyB,UAAU,GAAGvC,CAAC,CAACqC,IAAF,CAAON,MAAP,CAActB,CAAd,EAAiB+B,IAAjB,EAAjB;;AACA,MAAIT,MAAM,GAAG9D,QAAQ,CAAC;AACpB8E,IAAAA,gBAAgB,EAAElD,CAAC,CAACqC,aAAF,CAAgBzB,CAAhB,EAAmB,OAAnB;AADE,GAAD,EAElB8B,UAFkB,CAArB;;AAGA,MAAI,CAAC,GAAGtC,OAAO,CAAC+C,OAAZ,EAAqBvC,CAArB,CAAJ,EAA6B;AAC3BsB,IAAAA,MAAM,CAACC,UAAP,GAAoB,OAApB;AACAD,IAAAA,MAAM,CAACE,KAAP,GAAepC,CAAC,CAACqC,aAAF,CAAgBzB,CAAhB,EAAmB,OAAnB,CAAf;AACD,GAHD,MAGO;AACLsB,IAAAA,MAAM,CAACC,UAAP,GAAoB,KAApB;AACAD,IAAAA,MAAM,CAACY,WAAP,GAAqB,CAAC,GAAGzC,aAAa,CAAC0C,2BAAlB,EAA+CnC,CAA/C,CAArB;AACD;;AACD,GAAC,GAAGlB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDd,CAAC,CAACmB,aAApD,EAAmE,IAAnE;;AACAzB,EAAAA,SAAS,CAACa,OAAV,CAAkB0C,kBAAlB,CAAqCnC,EAArC,EAAyCiB,MAAzC,EAAiD,UAAUrB,KAAV,EAAiBwC,MAAjB,EAAyB;AACxE,QAAI3B,YAAY,GAAG,KAAK,CAAxB;;AACA,QAAIb,KAAJ,EAAW;AACT,UAAIyC,EAAE,GAAG,CAAC,GAAG5D,MAAM,CAAC8B,IAAX,EAAiB9B,MAAM,CAAC+B,SAAxB,EAAmC,MAAnC,EAA2CR,EAA3C,CAAT;;AACAS,MAAAA,YAAY,GAAGf,eAAe,CAAC2C,EAAD,EAAKzC,KAAL,CAA9B;;AACA,UAAIA,KAAK,CAAC0C,YAAV,EAAwB;AACtBC,QAAAA,OAAO,CAAC3C,KAAR,CAAcA,KAAK,CAACC,WAApB;AACD;;AACDX,MAAAA,CAAC,CAACsD,2BAAF,CAA8BH,EAA9B,EAAkCzC,KAAlC;AACA,aAAO,CAAC,GAAGnB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDd,CAAC,CAACmB,aAApD,EAAmE,KAAnE,EAA0EI,YAA1E,CAAP;AACD,KARD,MAQO;AACL,aAAO,CAAC,GAAG/B,QAAQ,CAAC+D,YAAb,EAA2BzC,EAA3B,EAA+BoC,MAA/B,CAAP;AACD;AACF,GAbD;AAcD;;AAED,SAAS/D,OAAT,CAAiB2B,EAAjB,EAAqB;AACnB,GAAC,GAAGvB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDb,OAAO,CAACuD,mBAA1D;AACD;;AAED,SAASpE,qBAAT,CAA+B0B,EAA/B,EAAmC;AACjC,GAAC,GAAGvB,MAAM,CAAC0B,IAAX,EAAiB1B,MAAM,CAAC2B,YAAxB,EAAsC,MAAtC,EAA8CJ,EAA9C,EAAkDb,OAAO,CAACb,qBAA1D;AACD","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.requestPasswordlessEmail = requestPasswordlessEmail;\nexports.requestPasswordlessEmailSuccess = requestPasswordlessEmailSuccess;\nexports.requestPasswordlessEmailError = requestPasswordlessEmailError;\nexports.resendEmail = resendEmail;\nexports.sendSMS = sendSMS;\nexports.logIn = logIn;\nexports.restart = restart;\nexports.toggleTermsAcceptance = toggleTermsAcceptance;\n\nvar _immutable = require('immutable');\n\nvar _index = require('../../store/index');\n\nvar _actions = require('../../core/actions');\n\nvar _web_api = require('../../core/web_api');\n\nvar _web_api2 = _interopRequireDefault(_web_api);\n\nvar _index2 = require('../../field/index');\n\nvar c = _interopRequireWildcard(_index2);\n\nvar _index3 = require('../../core/index');\n\nvar l = _interopRequireWildcard(_index3);\n\nvar _index4 = require('./index');\n\nvar _phone_number = require('../../field/phone_number');\n\nvar _i18n = require('../../i18n');\n\nvar i18n = _interopRequireWildcard(_i18n);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getErrorMessage(m, error) {\n  var key = error.error;\n\n  if (error.error === 'sms_provider_error' && (error.description || '').indexOf('(Code: 21211)') > -1) {\n    key = 'bad.phone_number';\n  }\n\n  return i18n.html(m, ['error', 'passwordless', key]) || i18n.html(m, ['error', 'passwordless', 'lock.fallback']);\n}\n\nfunction requestPasswordlessEmail(id) {\n  (0, _actions.validateAndSubmit)(id, ['email'], function (m) {\n    sendEmail(m, requestPasswordlessEmailSuccess, requestPasswordlessEmailError);\n  });\n}\n\nfunction requestPasswordlessEmailSuccess(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    m = l.setSubmitting(m, false);\n    return (0, _index4.setPasswordlessStarted)(m, true);\n  });\n}\n\nfunction requestPasswordlessEmailError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var errorMessage = getErrorMessage(m, error);\n  return (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n}\n\nfunction resendEmail(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.resend);\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  sendEmail(m, resendEmailSuccess, resendEmailError);\n}\n\nfunction resendEmailSuccess(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setResendSuccess);\n}\n\nfunction resendEmailError(id, error) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setResendFailed);\n}\n\nfunction sendEmail(m, successFn, errorFn) {\n  var params = {\n    connection: 'email',\n    email: c.getFieldValue(m, 'email'),\n    send: (0, _index4.send)(m)\n  };\n\n  if ((0, _index4.isSendLink)(m) && !l.auth.params(m).isEmpty()) {\n    params.authParams = l.auth.params(m).toJS();\n  }\n\n  _web_api2.default.startPasswordless(l.id(m), params, function (error) {\n    if (error) {\n      setTimeout(function () {\n        return errorFn(l.id(m), error);\n      }, 250);\n    } else {\n      successFn(l.id(m));\n    }\n  });\n}\n\nfunction sendSMS(id) {\n  (0, _actions.validateAndSubmit)(id, ['phoneNumber'], function (m) {\n    var params = {\n      connection: 'sms',\n      phoneNumber: (0, _phone_number.phoneNumberWithDiallingCode)(m),\n      send: (0, _index4.send)(m)\n    };\n    _web_api2.default.startPasswordless(id, params, function (error) {\n      if (error) {\n        setTimeout(function () {\n          return sendSMSError(id, error);\n        }, 250);\n      } else {\n        sendSMSSuccess(id);\n      }\n    });\n  });\n}\n\nfunction sendSMSSuccess(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    m = l.setSubmitting(m, false);\n    m = (0, _index4.setPasswordlessStarted)(m, true);\n    return m;\n  });\n}\n\nfunction sendSMSError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var errorMessage = getErrorMessage(m, error);\n  return (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n}\n\nfunction logIn(id) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var authParams = l.auth.params(m).toJS();\n  var params = _extends({\n    verificationCode: c.getFieldValue(m, 'vcode')\n  }, authParams);\n  if ((0, _index4.isEmail)(m)) {\n    params.connection = 'email';\n    params.email = c.getFieldValue(m, 'email');\n  } else {\n    params.connection = 'sms';\n    params.phoneNumber = (0, _phone_number.phoneNumberWithDiallingCode)(m);\n  }\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, true);\n  _web_api2.default.passwordlessVerify(id, params, function (error, result) {\n    var errorMessage = void 0;\n    if (error) {\n      var _m = (0, _index.read)(_index.getEntity, 'lock', id);\n      errorMessage = getErrorMessage(_m, error);\n      if (error.logToConsole) {\n        console.error(error.description);\n      }\n      l.emitAuthorizationErrorEvent(_m, error);\n      return (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n    } else {\n      return (0, _actions.logInSuccess)(id, result);\n    }\n  });\n}\n\nfunction restart(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.restartPasswordless);\n}\n\nfunction toggleTermsAcceptance(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.toggleTermsAcceptance);\n}\n"]},"metadata":{},"sourceType":"script"}