{"ast":null,"code":"var _ = require('../helper');\n\nvar contains = require('./contains');\n\nfunction createIntroMessage() {\n  return 'Contain at least %d of the following %d types of characters:';\n}\n\nmodule.exports = {\n  // TODO validate atLeast to be a number > 0 and expressions to be a list of at least 1\n  validate: function (options) {\n    if (!_.isObject(options)) {\n      throw new Error('options should be an object');\n    }\n\n    if (!_.isNumber(options.atLeast) || _.isNaN(options.atLeast) || options.atLeast < 1) {\n      throw new Error('atLeast should be a valid, non-NaN number, greater than 0');\n    }\n\n    if (!_.isArray(options.expressions) || _.isEmpty(options.expressions)) {\n      throw new Error('expressions should be an non-empty array');\n    }\n\n    if (options.expressions.length < options.atLeast) {\n      throw new Error('expressions length should be greater than atLeast');\n    }\n\n    var ok = options.expressions.every(function (expression) {\n      return _.isFunction(expression.explain) && _.isFunction(expression.test);\n    });\n\n    if (!ok) {\n      throw new Error('containsAtLeast expressions are invalid: An explain and a test function should be provided');\n    }\n\n    return true;\n  },\n  explain: function (options) {\n    return {\n      message: createIntroMessage(),\n      code: 'containsAtLeast',\n      format: [options.atLeast, options.expressions.length],\n      items: options.expressions.map(function (x) {\n        return x.explain();\n      })\n    };\n  },\n  missing: function (options, password) {\n    var expressions = options.expressions && options.expressions.map(function (expression) {\n      var explained = expression.explain();\n      explained.verified = expression.test(password);\n      return explained;\n    });\n    var verifiedCount = expressions.reduce(function (val, ex) {\n      return val + !!ex.verified;\n    }, 0);\n    var verified = verifiedCount >= options.atLeast;\n    return {\n      message: createIntroMessage(),\n      code: 'containsAtLeast',\n      format: [options.atLeast, options.expressions.length],\n      items: expressions,\n      verified: verified\n    };\n  },\n  assert: function (options, password) {\n    if (!password) {\n      return false;\n    }\n\n    var workingExpressions = options.expressions.filter(function (expression) {\n      return expression.test(password);\n    });\n    return workingExpressions.length >= options.atLeast;\n  },\n  charsets: contains.charsets\n};","map":{"version":3,"sources":["/Users/jacksonmccomas/Documents/Lambda/labs/startup-grant-database-fe/grantly/node_modules/password-sheriff/lib/rules/containsAtLeast.js"],"names":["_","require","contains","createIntroMessage","module","exports","validate","options","isObject","Error","isNumber","atLeast","isNaN","isArray","expressions","isEmpty","length","ok","every","expression","isFunction","explain","test","message","code","format","items","map","x","missing","password","explained","verified","verifiedCount","reduce","val","ex","assert","workingExpressions","filter","charsets"],"mappings":"AAAA,IAAIA,CAAC,GAAGC,OAAO,CAAC,WAAD,CAAf;;AAEA,IAAIC,QAAQ,GAAGD,OAAO,CAAC,YAAD,CAAtB;;AAEA,SAASE,kBAAT,GAA8B;AAC5B,SAAO,8DAAP;AACD;;AAEDC,MAAM,CAACC,OAAP,GAAiB;AACf;AACAC,EAAAA,QAAQ,EAAE,UAAUC,OAAV,EAAmB;AAC3B,QAAI,CAACP,CAAC,CAACQ,QAAF,CAAWD,OAAX,CAAL,EAA0B;AACxB,YAAM,IAAIE,KAAJ,CAAU,6BAAV,CAAN;AACD;;AAED,QAAI,CAACT,CAAC,CAACU,QAAF,CAAWH,OAAO,CAACI,OAAnB,CAAD,IAAgCX,CAAC,CAACY,KAAF,CAAQL,OAAO,CAACI,OAAhB,CAAhC,IAA4DJ,OAAO,CAACI,OAAR,GAAkB,CAAlF,EAAqF;AACnF,YAAM,IAAIF,KAAJ,CAAU,2DAAV,CAAN;AACD;;AAED,QAAI,CAACT,CAAC,CAACa,OAAF,CAAUN,OAAO,CAACO,WAAlB,CAAD,IAAmCd,CAAC,CAACe,OAAF,CAAUR,OAAO,CAACO,WAAlB,CAAvC,EAAuE;AACrE,YAAM,IAAIL,KAAJ,CAAU,0CAAV,CAAN;AACD;;AAED,QAAIF,OAAO,CAACO,WAAR,CAAoBE,MAApB,GAA6BT,OAAO,CAACI,OAAzC,EAAkD;AAChD,YAAM,IAAIF,KAAJ,CAAU,mDAAV,CAAN;AACD;;AAED,QAAIQ,EAAE,GAAGV,OAAO,CAACO,WAAR,CAAoBI,KAApB,CAA0B,UAAUC,UAAV,EAAsB;AACvD,aAAOnB,CAAC,CAACoB,UAAF,CAAaD,UAAU,CAACE,OAAxB,KAAoCrB,CAAC,CAACoB,UAAF,CAAaD,UAAU,CAACG,IAAxB,CAA3C;AACD,KAFQ,CAAT;;AAIA,QAAI,CAACL,EAAL,EAAS;AACP,YAAM,IAAIR,KAAJ,CAAU,4FAAV,CAAN;AACD;;AAED,WAAO,IAAP;AACD,GA5Bc;AA6BfY,EAAAA,OAAO,EAAE,UAAUd,OAAV,EAAmB;AAC1B,WAAO;AACLgB,MAAAA,OAAO,EAAEpB,kBAAkB,EADtB;AAELqB,MAAAA,IAAI,EAAE,iBAFD;AAGLC,MAAAA,MAAM,EAAE,CAAClB,OAAO,CAACI,OAAT,EAAkBJ,OAAO,CAACO,WAAR,CAAoBE,MAAtC,CAHH;AAILU,MAAAA,KAAK,EAAEnB,OAAO,CAACO,WAAR,CAAoBa,GAApB,CAAwB,UAAUC,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACP,OAAF,EAAP;AAAqB,OAA5D;AAJF,KAAP;AAMD,GApCc;AAqCfQ,EAAAA,OAAO,EAAE,UAAUtB,OAAV,EAAmBuB,QAAnB,EAA6B;AACpC,QAAIhB,WAAW,GAAGP,OAAO,CAACO,WAAR,IAAuBP,OAAO,CAACO,WAAR,CAAoBa,GAApB,CAAwB,UAAUR,UAAV,EAAsB;AACrF,UAAIY,SAAS,GAAGZ,UAAU,CAACE,OAAX,EAAhB;AACAU,MAAAA,SAAS,CAACC,QAAV,GAAqBb,UAAU,CAACG,IAAX,CAAgBQ,QAAhB,CAArB;AACA,aAAOC,SAAP;AACD,KAJwC,CAAzC;AAMA,QAAIE,aAAa,GAAGnB,WAAW,CAACoB,MAAZ,CAAmB,UAAUC,GAAV,EAAeC,EAAf,EAAmB;AAAE,aAAOD,GAAG,GAAG,CAAC,CAACC,EAAE,CAACJ,QAAlB;AAA6B,KAArE,EAAuE,CAAvE,CAApB;AACA,QAAIA,QAAQ,GAAGC,aAAa,IAAI1B,OAAO,CAACI,OAAxC;AAEA,WAAO;AACLY,MAAAA,OAAO,EAAEpB,kBAAkB,EADtB;AAELqB,MAAAA,IAAI,EAAE,iBAFD;AAGLC,MAAAA,MAAM,EAAE,CAAClB,OAAO,CAACI,OAAT,EAAkBJ,OAAO,CAACO,WAAR,CAAoBE,MAAtC,CAHH;AAILU,MAAAA,KAAK,EAAEZ,WAJF;AAKLkB,MAAAA,QAAQ,EAAEA;AALL,KAAP;AAOD,GAtDc;AAuDfK,EAAAA,MAAM,EAAE,UAAU9B,OAAV,EAAmBuB,QAAnB,EAA6B;AACnC,QAAI,CAACA,QAAL,EAAe;AACb,aAAO,KAAP;AACD;;AAED,QAAIQ,kBAAkB,GAAG/B,OAAO,CAACO,WAAR,CAAoByB,MAApB,CAA2B,UAAUpB,UAAV,EAAsB;AACxE,aAAOA,UAAU,CAACG,IAAX,CAAgBQ,QAAhB,CAAP;AACD,KAFwB,CAAzB;AAIA,WAAOQ,kBAAkB,CAACtB,MAAnB,IAA6BT,OAAO,CAACI,OAA5C;AACD,GAjEc;AAkEf6B,EAAAA,QAAQ,EAAEtC,QAAQ,CAACsC;AAlEJ,CAAjB","sourcesContent":["var _ = require('../helper');\n\nvar contains = require('./contains');\n\nfunction createIntroMessage() {\n  return 'Contain at least %d of the following %d types of characters:';\n}\n\nmodule.exports = {\n  // TODO validate atLeast to be a number > 0 and expressions to be a list of at least 1\n  validate: function (options) {\n    if (!_.isObject(options)) {\n      throw new Error('options should be an object');\n    }\n\n    if (!_.isNumber(options.atLeast) || _.isNaN(options.atLeast) || options.atLeast < 1) {\n      throw new Error('atLeast should be a valid, non-NaN number, greater than 0');\n    }\n\n    if (!_.isArray(options.expressions) || _.isEmpty(options.expressions)) {\n      throw new Error('expressions should be an non-empty array');\n    }\n\n    if (options.expressions.length < options.atLeast) {\n      throw new Error('expressions length should be greater than atLeast');\n    }\n\n    var ok = options.expressions.every(function (expression) {\n      return _.isFunction(expression.explain) && _.isFunction(expression.test);\n    });\n\n    if (!ok) {\n      throw new Error('containsAtLeast expressions are invalid: An explain and a test function should be provided');\n    }\n\n    return true;\n  },\n  explain: function (options) {\n    return {\n      message: createIntroMessage(),\n      code: 'containsAtLeast',\n      format: [options.atLeast, options.expressions.length],\n      items: options.expressions.map(function (x) { return x.explain(); })\n    };\n  },\n  missing: function (options, password) {\n    var expressions = options.expressions && options.expressions.map(function (expression) {\n      var explained = expression.explain();\n      explained.verified = expression.test(password);\n      return explained;\n    });\n\n    var verifiedCount = expressions.reduce(function (val, ex) { return val + !!ex.verified; }, 0);\n    var verified = verifiedCount >= options.atLeast;\n\n    return {\n      message: createIntroMessage(),\n      code: 'containsAtLeast',\n      format: [options.atLeast, options.expressions.length],\n      items: expressions,\n      verified: verified\n    };\n  },\n  assert: function (options, password) {\n    if (!password) {\n      return false;\n    }\n\n    var workingExpressions = options.expressions.filter(function (expression) {\n      return expression.test(password);\n    });\n\n    return workingExpressions.length >= options.atLeast;\n  },\n  charsets: contains.charsets\n};\n"]},"metadata":{},"sourceType":"script"}