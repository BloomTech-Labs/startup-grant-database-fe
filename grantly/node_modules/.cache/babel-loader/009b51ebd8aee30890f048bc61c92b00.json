{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\nexports.initDatabase = initDatabase;\nexports.overrideDatabaseOptions = overrideDatabaseOptions;\nexports.defaultDatabaseConnection = defaultDatabaseConnection;\nexports.defaultDatabaseConnectionName = defaultDatabaseConnectionName;\nexports.databaseConnection = databaseConnection;\nexports.databaseConnectionName = databaseConnectionName;\nexports.forgotPasswordLink = forgotPasswordLink;\nexports.signUpLink = signUpLink;\nexports.setScreen = setScreen;\nexports.getScreen = getScreen;\nexports.availableScreens = availableScreens;\nexports.getInitialScreen = getInitialScreen;\nexports.hasInitialScreen = hasInitialScreen;\nexports.databaseConnectionRequiresUsername = databaseConnectionRequiresUsername;\nexports.databaseUsernameStyle = databaseUsernameStyle;\nexports.databaseLogInWithEmail = databaseLogInWithEmail;\nexports.databaseUsernameValue = databaseUsernameValue;\nexports.authWithUsername = authWithUsername;\nexports.hasScreen = hasScreen;\nexports.shouldAutoLogin = shouldAutoLogin;\nexports.passwordStrengthPolicy = passwordStrengthPolicy;\nexports.additionalSignUpFields = additionalSignUpFields;\nexports.showTerms = showTerms;\nexports.mustAcceptTerms = mustAcceptTerms;\nexports.termsAccepted = termsAccepted;\nexports.toggleTermsAcceptance = toggleTermsAcceptance;\nexports.resolveAdditionalSignUpFields = resolveAdditionalSignUpFields;\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _index = require('../../core/index');\n\nvar l = _interopRequireWildcard(_index);\n\nvar _index2 = require('../../field/index');\n\nvar _data_utils = require('../../utils/data_utils');\n\nvar _sync = require('../../sync');\n\nvar _sync2 = _interopRequireDefault(_sync);\n\nvar _trim = require('trim');\n\nvar _trim2 = _interopRequireDefault(_trim);\n\nvar _tenant = require('../../core/tenant');\n\nvar _enterprise = require('../../connection/enterprise');\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar _dataFns = (0, _data_utils.dataFns)(['database']),\n    get = _dataFns.get,\n    initNS = _dataFns.initNS,\n    tget = _dataFns.tget,\n    tset = _dataFns.tset;\n\nfunction initDatabase(m, options) {\n  m = initNS(m, _immutable2.default.fromJS(processDatabaseOptions(options)));\n  m = resolveAdditionalSignUpFields(m);\n  return m;\n}\n\nfunction assertMaybeBoolean(opts, name) {\n  var valid = opts[name] === undefined || typeof opts[name] === 'boolean';\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not a booelan.');\n  return valid;\n}\n\nfunction assertMaybeEnum(opts, name, a) {\n  var valid = opts[name] === undefined || a.indexOf(opts[name]) > -1;\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not one of the following allowed values: ' + a.map(function (x) {\n    return JSON.stringify(x);\n  }).join(', ') + '.');\n  return valid;\n}\n\nfunction assertMaybeString(opts, name) {\n  var valid = opts[name] === undefined || typeof opts[name] === 'string' && (0, _trim2.default)(opts[name]).length > 0;\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not a non-empty string.');\n  return valid;\n}\n\nfunction assertMaybeArray(opts, name) {\n  var valid = opts[name] === undefined || global.Array.isArray(opts[name]);\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not an array.');\n  return valid;\n}\n\nfunction processDatabaseOptions(opts) {\n  var additionalSignUpFields = opts.additionalSignUpFields,\n      defaultDatabaseConnection = opts.defaultDatabaseConnection,\n      forgotPasswordLink = opts.forgotPasswordLink,\n      loginAfterSignUp = opts.loginAfterSignUp,\n      mustAcceptTerms = opts.mustAcceptTerms,\n      showTerms = opts.showTerms,\n      signUpLink = opts.signUpLink,\n      usernameStyle = opts.usernameStyle;\n\n  var _processScreenOptions = processScreenOptions(opts),\n      initialScreen = _processScreenOptions.initialScreen,\n      screens = _processScreenOptions.screens;\n\n  if (!assertMaybeEnum(opts, 'usernameStyle', ['email', 'username'])) {\n    usernameStyle = undefined;\n  }\n\n  if (!assertMaybeString(opts, 'defaultDatabaseConnection')) {\n    defaultDatabaseConnection = undefined;\n  }\n\n  if (!assertMaybeString(opts, 'forgotPasswordLink')) {\n    forgotPasswordLink = undefined;\n  }\n\n  if (!assertMaybeString(opts, 'signUpLink')) {\n    signUpLink = undefined;\n  }\n\n  if (!assertMaybeBoolean(opts, 'mustAcceptTerms')) {\n    mustAcceptTerms = undefined;\n  }\n\n  if (!assertMaybeBoolean(opts, 'showTerms')) {\n    showTerms = true;\n  }\n\n  if (!assertMaybeArray(opts, 'additionalSignUpFields')) {\n    additionalSignUpFields = undefined;\n  } else if (additionalSignUpFields) {\n    additionalSignUpFields = additionalSignUpFields.reduce(function (r, x) {\n      var icon = x.icon,\n          name = x.name,\n          options = x.options,\n          placeholder = x.placeholder,\n          placeholderHTML = x.placeholderHTML,\n          prefill = x.prefill,\n          type = x.type,\n          validator = x.validator,\n          value = x.value,\n          storage = x.storage;\n      var filter = true;\n      var reservedNames = ['email', 'username', 'password'];\n\n      if (typeof name != 'string' || !name.match(/^[a-zA-Z0-9_]+$/) || reservedNames.indexOf(name) > -1) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` because it does not contain valid `name` property. Every element of `additionalSignUpFields` must be an object with a `name` property that is a non-empty string consisting of letters, numbers and underscores. The following names are reserved, and therefore, cannot be used: ' + reservedNames.join(', ') + '.');\n        filter = false;\n      }\n\n      if (type !== 'hidden' && (typeof placeholder != 'string' || !placeholder) && (typeof placeholderHTML != 'string' || !placeholderHTML)) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` (' + name + ') because it does not contain a valid `placeholder` or `placeholderHTML` property. Every element of `additionalSignUpFields` must have a `placeholder` or `placeholderHTML` property that is a non-empty string.');\n        filter = false;\n      }\n\n      if (placeholderHTML && placeholder) {\n        l.warn(opts, 'When provided, the `placeholderHTML` property of an element of `additionalSignUpFields` will override the `placeholder` property of that element');\n      }\n\n      if (icon != undefined && (typeof icon != 'string' || !icon)) {\n        l.warn(opts, 'When provided, the `icon` property of an element of `additionalSignUpFields` must be a non-empty string.');\n        icon = undefined;\n      }\n\n      if (prefill != undefined && (typeof prefill != 'string' || !prefill) && typeof prefill != 'function') {\n        l.warn(opts, 'When provided, the `prefill` property of an element of `additionalSignUpFields` must be a non-empty string or a function.');\n        prefill = undefined;\n      }\n\n      var types = ['select', 'text', 'checkbox', 'hidden'];\n\n      if (type != undefined && (typeof type != 'string' || types.indexOf(type) === -1)) {\n        l.warn(opts, 'When provided, the `type` property of an element of `additionalSignUpFields` must be one of the following strings: \"' + types.join('\", \"') + '\".');\n        type = undefined;\n      }\n\n      if (validator != undefined && type === 'select') {\n        l.warn(opts, 'Elements of `additionalSignUpFields` with a \"select\" `type` cannot specify a `validator` function, all of its `options` are assumed to be valid.');\n        validator = undefined;\n      }\n\n      if (validator != undefined && typeof validator != 'function') {\n        l.warn(opts, 'When provided, the `validator` property of an element of `additionalSignUpFields` must be a function.');\n        validator = undefined;\n      }\n\n      if (options != undefined && type != 'select') {\n        l.warn(opts, 'The `options` property can only by provided for an element of `additionalSignUpFields` when its `type` equals to \"select\"');\n        options = undefined;\n      }\n\n      if (options != undefined && !global.Array.isArray(options) && typeof options != 'function' || type === 'select' && options === undefined) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` (' + name + ') because it has a \"select\" `type` but does not specify an `options` property that is an Array or a function.');\n        filter = false;\n      }\n\n      if (type === 'hidden' && !value) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` (' + name + ') because it has a \"hidden\" `type` but does not specify a `value` string.');\n        filter = false;\n      }\n\n      return filter ? r.concat([{\n        icon: icon,\n        name: name,\n        options: options,\n        placeholder: placeholder,\n        placeholderHTML: placeholderHTML,\n        prefill: prefill,\n        type: type,\n        validator: validator,\n        value: value,\n        storage: storage\n      }]) : r;\n    }, []);\n    additionalSignUpFields = _immutable2.default.fromJS(additionalSignUpFields).map(function (x) {\n      return x.filter(function (y) {\n        return y !== undefined;\n      });\n    });\n  } // TODO: add a warning if it is not a boolean, leave it undefined,\n  // and change accessor fn.\n\n\n  loginAfterSignUp = loginAfterSignUp === false ? false : true;\n  return (0, _immutable.Map)({\n    additionalSignUpFields: additionalSignUpFields,\n    defaultConnectionName: defaultDatabaseConnection,\n    forgotPasswordLink: forgotPasswordLink,\n    initialScreen: initialScreen,\n    loginAfterSignUp: loginAfterSignUp,\n    mustAcceptTerms: mustAcceptTerms,\n    showTerms: showTerms,\n    screens: screens,\n    signUpLink: signUpLink,\n    usernameStyle: usernameStyle\n  }).filter(function (x) {\n    return typeof x !== 'undefined';\n  }).toJS();\n}\n\nfunction processScreenOptions(opts) {\n  var defaults = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    allowLogin: true,\n    allowSignUp: true,\n    allowForgotPassword: true,\n    initialScreen: undefined\n  };\n  var allowForgotPassword = opts.allowForgotPassword,\n      allowLogin = opts.allowLogin,\n      allowSignUp = opts.allowSignUp,\n      initialScreen = opts.initialScreen;\n  var screens = [];\n\n  if (allowLogin === true || !assertMaybeBoolean(opts, 'allowLogin') && defaults.allowLogin || allowLogin === undefined && defaults.allowLogin) {\n    screens.push('login');\n  }\n\n  if (allowSignUp === true || !assertMaybeBoolean(opts, 'allowSignUp') && defaults.allowSignUp || allowSignUp === undefined && defaults.allowSignUp) {\n    screens.push('signUp');\n  }\n\n  if (allowForgotPassword === true || !assertMaybeBoolean(opts, 'allowForgotPassword') && defaults.allowForgotPassword || allowForgotPassword === undefined && defaults.allowForgotPassword) {\n    screens.push('forgotPassword');\n  }\n\n  screens.push('mfaLogin');\n\n  if (!assertMaybeEnum(opts, 'initialScreen', screens)) {\n    initialScreen = undefined;\n  }\n\n  if (initialScreen === undefined) {\n    initialScreen = defaults.initialScreen || screens[0];\n  }\n\n  return {\n    initialScreen: initialScreen,\n    screens: new _immutable.List(screens)\n  };\n}\n\nfunction overrideDatabaseOptions(m, opts) {\n  var _processScreenOptions2 = processScreenOptions(opts, {\n    allowLogin: availableScreens(m).contains('login'),\n    allowSignUp: availableScreens(m).contains('signUp'),\n    allowForgotPassword: availableScreens(m).contains('forgotPassword'),\n    initialScreen: get(m, 'initialScreen')\n  }),\n      initialScreen = _processScreenOptions2.initialScreen,\n      screens = _processScreenOptions2.screens;\n\n  m = tset(m, 'initialScreen', initialScreen);\n  m = tset(m, 'screens', screens);\n  return m;\n}\n\nfunction defaultDatabaseConnection(m) {\n  var name = defaultDatabaseConnectionName(m);\n  return name && l.findConnection(m, name);\n}\n\nfunction defaultDatabaseConnectionName(m) {\n  return get(m, 'defaultConnectionName');\n}\n\nfunction databaseConnection(m) {\n  return l.resolvedConnection(m) || (0, _tenant.defaultDirectory)(m) || defaultDatabaseConnection(m) || l.connection(m, 'database');\n}\n\nfunction databaseConnectionName(m) {\n  return (databaseConnection(m) || (0, _immutable.Map)()).get('name');\n}\n\nfunction forgotPasswordLink(m) {\n  var notFound = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  return get(m, 'forgotPasswordLink', notFound);\n}\n\nfunction signUpLink(m) {\n  var notFound = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  return get(m, 'signUpLink', notFound);\n}\n\nfunction setScreen(m, name) {\n  var fields = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : []; // TODO: the lock/index module should provide a way to clear\n  // everything that needs the be cleared when changing screens, other\n  // modules should not care.\n\n  m = l.clearGlobalError(m);\n  m = l.clearGlobalSuccess(m);\n  m = (0, _index2.hideInvalidFields)(m, fields);\n  m = (0, _index2.clearFields)(m, fields);\n  return tset(m, 'screen', name);\n}\n\nfunction getScreen(m) {\n  var screen = tget(m, 'screen');\n  var initialScreen = getInitialScreen(m);\n  var screens = [screen, initialScreen, 'login', 'signUp', 'forgotPassword', 'mfaLogin'];\n  var availableScreens = screens.filter(function (x) {\n    return hasScreen(m, x);\n  });\n  return availableScreens[0];\n}\n\nfunction availableScreens(m) {\n  return tget(m, 'screens') || get(m, 'screens', new _immutable.List());\n}\n\nfunction getInitialScreen(m) {\n  return tget(m, 'initialScreen') || get(m, 'initialScreen');\n}\n\nfunction hasInitialScreen(m, str) {\n  return getInitialScreen(m) === str;\n}\n\nfunction databaseConnectionRequiresUsername(m) {\n  return (databaseConnection(m) || (0, _immutable.Map)()).toJS().requireUsername;\n}\n\nfunction databaseUsernameStyle(m) {\n  if (l.hasSomeConnections(m, 'database')) {\n    return databaseConnectionRequiresUsername(m) ? get(m, 'usernameStyle', 'any') : 'email';\n  }\n\n  return l.hasSomeConnections(m, 'enterprise') && (0, _enterprise.findADConnectionWithoutDomain)(m) ? 'username' : 'email';\n}\n\nfunction databaseLogInWithEmail(m) {\n  return databaseUsernameStyle(m) === 'email';\n}\n\nfunction databaseUsernameValue(m) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var isEmailOnly = databaseLogInWithEmail(m);\n\n  if (isEmailOnly) {\n    return (0, _index2.getFieldValue)(m, 'email');\n  }\n\n  if (options.emailFirst) {\n    return (0, _index2.getFieldValue)(m, 'email') || (0, _index2.getFieldValue)(m, 'username');\n  }\n\n  return (0, _index2.getFieldValue)(m, 'username') || (0, _index2.getFieldValue)(m, 'email');\n}\n\nfunction authWithUsername(m) {\n  return databaseConnectionRequiresUsername(m) || get(m, 'usernameStyle', 'email') === 'username';\n}\n\nfunction hasScreen(m, s) {\n  var _toJS = (databaseConnection(m) || (0, _immutable.Map)()).toJS(),\n      allowForgot = _toJS.allowForgot,\n      allowSignup = _toJS.allowSignup;\n\n  return !(allowForgot === false && s === 'forgotPassword') && !(allowSignup === false && s === 'signUp') && availableScreens(m).contains(s);\n}\n\nfunction shouldAutoLogin(m) {\n  return get(m, 'loginAfterSignUp');\n}\n\nfunction passwordStrengthPolicy(m) {\n  return (databaseConnection(m) || (0, _immutable.Map)()).get('passwordPolicy', 'none');\n}\n\nfunction additionalSignUpFields(m) {\n  return get(m, 'additionalSignUpFields', (0, _immutable.List)());\n}\n\nfunction showTerms(m) {\n  return get(m, 'showTerms', true);\n}\n\nfunction mustAcceptTerms(m) {\n  return get(m, 'mustAcceptTerms', false);\n}\n\nfunction termsAccepted(m) {\n  return !mustAcceptTerms(m) || tget(m, 'termsAccepted', false);\n}\n\nfunction toggleTermsAcceptance(m) {\n  return tset(m, 'termsAccepted', !termsAccepted(m));\n}\n\nfunction resolveAdditionalSignUpFields(m) {\n  return additionalSignUpFields(m).reduce(function (r, x) {\n    switch (x.get('type')) {\n      case 'select':\n        return resolveAdditionalSignUpSelectField(r, x);\n\n      case 'hidden':\n        return resolveAdditionalSignUpHiddenField(r, x);\n\n      default:\n        return resolveAdditionalSignUpTextField(r, x);\n    }\n  }, m);\n}\n\nfunction resolveAdditionalSignUpSelectField(m, x) {\n  var name = x.get('name');\n  var keyNs = ['additionalSignUpField', name];\n  var prefill = x.get('prefill');\n  var options = x.get('options');\n  var resolvedPrefill = typeof prefill === 'function' ? undefined : prefill || '';\n  var resolvedOptions = typeof options === 'function' ? undefined : options;\n\n  var register = function register(m) {\n    return resolvedPrefill !== undefined && resolvedOptions !== undefined ? (0, _index2.registerOptionField)(m, name, _immutable2.default.fromJS(resolvedOptions), resolvedPrefill) : m;\n  };\n\n  if (resolvedPrefill === undefined) {\n    m = (0, _sync2.default)(m, keyNs.concat('prefill'), {\n      recoverResult: '',\n      successFn: function successFn(m, result) {\n        resolvedPrefill = result;\n        return register(m);\n      },\n      syncFn: function syncFn(m, cb) {\n        return prefill(cb);\n      }\n    });\n  }\n\n  if (resolvedOptions === undefined) {\n    m = (0, _sync2.default)(m, keyNs.concat('options'), {\n      successFn: function successFn(m, result) {\n        resolvedOptions = result;\n        return register(m);\n      },\n      syncFn: function syncFn(m, cb) {\n        return options(cb);\n      }\n    });\n  }\n\n  if (resolvedPrefill !== undefined && resolvedOptions !== undefined) {\n    m = (0, _index2.registerOptionField)(m, name, _immutable2.default.fromJS(resolvedOptions), resolvedPrefill);\n  }\n\n  return m;\n}\n\nfunction resolveAdditionalSignUpTextField(m, x) {\n  var name = x.get('name');\n  var key = ['additionalSignUpField', name, 'prefill'];\n  var prefill = x.get('prefill');\n  var validator = x.get('validator');\n  var resolvedPrefill = typeof prefill === 'function' ? undefined : prefill || '';\n\n  if (resolvedPrefill === undefined) {\n    m = (0, _sync2.default)(m, key, {\n      recoverResult: '',\n      successFn: function successFn(m, result) {\n        return (0, _index2.setField)(m, name, result, validator);\n      },\n      syncFn: function syncFn(m, cb) {\n        return prefill(cb);\n      }\n    });\n  } else {\n    m = (0, _index2.setField)(m, name, resolvedPrefill, validator);\n  }\n\n  return m;\n}\n\nfunction resolveAdditionalSignUpHiddenField(m, x) {\n  return (0, _index2.setField)(m, x.get('name'), x.get('value'));\n}","map":{"version":3,"sources":["/Users/jacksonmccomas/Documents/Lambda/labs/startup-grant-database-fe/grantly/node_modules/auth0-lock/lib/connection/database/index.js"],"names":["exports","__esModule","initDatabase","overrideDatabaseOptions","defaultDatabaseConnection","defaultDatabaseConnectionName","databaseConnection","databaseConnectionName","forgotPasswordLink","signUpLink","setScreen","getScreen","availableScreens","getInitialScreen","hasInitialScreen","databaseConnectionRequiresUsername","databaseUsernameStyle","databaseLogInWithEmail","databaseUsernameValue","authWithUsername","hasScreen","shouldAutoLogin","passwordStrengthPolicy","additionalSignUpFields","showTerms","mustAcceptTerms","termsAccepted","toggleTermsAcceptance","resolveAdditionalSignUpFields","_immutable","require","_immutable2","_interopRequireDefault","_index","l","_interopRequireWildcard","_index2","_data_utils","_sync","_sync2","_trim","_trim2","_tenant","_enterprise","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","_dataFns","dataFns","get","initNS","tget","tset","m","options","fromJS","processDatabaseOptions","assertMaybeBoolean","opts","name","valid","undefined","warn","assertMaybeEnum","a","indexOf","map","x","JSON","stringify","join","assertMaybeString","length","assertMaybeArray","global","Array","isArray","loginAfterSignUp","usernameStyle","_processScreenOptions","processScreenOptions","initialScreen","screens","reduce","r","icon","placeholder","placeholderHTML","prefill","type","validator","value","storage","filter","reservedNames","match","types","concat","y","Map","defaultConnectionName","toJS","defaults","arguments","allowLogin","allowSignUp","allowForgotPassword","push","List","_processScreenOptions2","contains","findConnection","resolvedConnection","defaultDirectory","connection","notFound","fields","clearGlobalError","clearGlobalSuccess","hideInvalidFields","clearFields","screen","str","requireUsername","hasSomeConnections","findADConnectionWithoutDomain","isEmailOnly","getFieldValue","emailFirst","s","_toJS","allowForgot","allowSignup","resolveAdditionalSignUpSelectField","resolveAdditionalSignUpHiddenField","resolveAdditionalSignUpTextField","keyNs","resolvedPrefill","resolvedOptions","register","registerOptionField","recoverResult","successFn","result","syncFn","cb","setField"],"mappings":"AAAA;;AAEAA,OAAO,CAACC,UAAR,GAAqB,IAArB;AACAD,OAAO,CAACE,YAAR,GAAuBA,YAAvB;AACAF,OAAO,CAACG,uBAAR,GAAkCA,uBAAlC;AACAH,OAAO,CAACI,yBAAR,GAAoCA,yBAApC;AACAJ,OAAO,CAACK,6BAAR,GAAwCA,6BAAxC;AACAL,OAAO,CAACM,kBAAR,GAA6BA,kBAA7B;AACAN,OAAO,CAACO,sBAAR,GAAiCA,sBAAjC;AACAP,OAAO,CAACQ,kBAAR,GAA6BA,kBAA7B;AACAR,OAAO,CAACS,UAAR,GAAqBA,UAArB;AACAT,OAAO,CAACU,SAAR,GAAoBA,SAApB;AACAV,OAAO,CAACW,SAAR,GAAoBA,SAApB;AACAX,OAAO,CAACY,gBAAR,GAA2BA,gBAA3B;AACAZ,OAAO,CAACa,gBAAR,GAA2BA,gBAA3B;AACAb,OAAO,CAACc,gBAAR,GAA2BA,gBAA3B;AACAd,OAAO,CAACe,kCAAR,GAA6CA,kCAA7C;AACAf,OAAO,CAACgB,qBAAR,GAAgCA,qBAAhC;AACAhB,OAAO,CAACiB,sBAAR,GAAiCA,sBAAjC;AACAjB,OAAO,CAACkB,qBAAR,GAAgCA,qBAAhC;AACAlB,OAAO,CAACmB,gBAAR,GAA2BA,gBAA3B;AACAnB,OAAO,CAACoB,SAAR,GAAoBA,SAApB;AACApB,OAAO,CAACqB,eAAR,GAA0BA,eAA1B;AACArB,OAAO,CAACsB,sBAAR,GAAiCA,sBAAjC;AACAtB,OAAO,CAACuB,sBAAR,GAAiCA,sBAAjC;AACAvB,OAAO,CAACwB,SAAR,GAAoBA,SAApB;AACAxB,OAAO,CAACyB,eAAR,GAA0BA,eAA1B;AACAzB,OAAO,CAAC0B,aAAR,GAAwBA,aAAxB;AACA1B,OAAO,CAAC2B,qBAAR,GAAgCA,qBAAhC;AACA3B,OAAO,CAAC4B,6BAAR,GAAwCA,6BAAxC;;AAEA,IAAIC,UAAU,GAAGC,OAAO,CAAC,WAAD,CAAxB;;AAEA,IAAIC,WAAW,GAAGC,sBAAsB,CAACH,UAAD,CAAxC;;AAEA,IAAII,MAAM,GAAGH,OAAO,CAAC,kBAAD,CAApB;;AAEA,IAAII,CAAC,GAAGC,uBAAuB,CAACF,MAAD,CAA/B;;AAEA,IAAIG,OAAO,GAAGN,OAAO,CAAC,mBAAD,CAArB;;AAEA,IAAIO,WAAW,GAAGP,OAAO,CAAC,wBAAD,CAAzB;;AAEA,IAAIQ,KAAK,GAAGR,OAAO,CAAC,YAAD,CAAnB;;AAEA,IAAIS,MAAM,GAAGP,sBAAsB,CAACM,KAAD,CAAnC;;AAEA,IAAIE,KAAK,GAAGV,OAAO,CAAC,MAAD,CAAnB;;AAEA,IAAIW,MAAM,GAAGT,sBAAsB,CAACQ,KAAD,CAAnC;;AAEA,IAAIE,OAAO,GAAGZ,OAAO,CAAC,mBAAD,CAArB;;AAEA,IAAIa,WAAW,GAAGb,OAAO,CAAC,6BAAD,CAAzB;;AAEA,SAASK,uBAAT,CAAiCS,GAAjC,EAAsC;AAAE,MAAIA,GAAG,IAAIA,GAAG,CAAC3C,UAAf,EAA2B;AAAE,WAAO2C,GAAP;AAAa,GAA1C,MAAgD;AAAE,QAAIC,MAAM,GAAG,EAAb;;AAAiB,QAAID,GAAG,IAAI,IAAX,EAAiB;AAAE,WAAK,IAAIE,GAAT,IAAgBF,GAAhB,EAAqB;AAAE,YAAIG,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCN,GAArC,EAA0CE,GAA1C,CAAJ,EAAoDD,MAAM,CAACC,GAAD,CAAN,GAAcF,GAAG,CAACE,GAAD,CAAjB;AAAyB;AAAE;;AAACD,IAAAA,MAAM,CAACM,OAAP,GAAiBP,GAAjB;AAAsB,WAAOC,MAAP;AAAgB;AAAE;;AAE7Q,SAASb,sBAAT,CAAgCY,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAAC3C,UAAX,GAAwB2C,GAAxB,GAA8B;AAAEO,IAAAA,OAAO,EAAEP;AAAX,GAArC;AAAwD;;AAE/F,IAAIQ,QAAQ,GAAG,CAAC,GAAGf,WAAW,CAACgB,OAAhB,EAAyB,CAAC,UAAD,CAAzB,CAAf;AAAA,IACIC,GAAG,GAAGF,QAAQ,CAACE,GADnB;AAAA,IAEIC,MAAM,GAAGH,QAAQ,CAACG,MAFtB;AAAA,IAGIC,IAAI,GAAGJ,QAAQ,CAACI,IAHpB;AAAA,IAIIC,IAAI,GAAGL,QAAQ,CAACK,IAJpB;;AAMA,SAASvD,YAAT,CAAsBwD,CAAtB,EAAyBC,OAAzB,EAAkC;AAChCD,EAAAA,CAAC,GAAGH,MAAM,CAACG,CAAD,EAAI3B,WAAW,CAACoB,OAAZ,CAAoBS,MAApB,CAA2BC,sBAAsB,CAACF,OAAD,CAAjD,CAAJ,CAAV;AACAD,EAAAA,CAAC,GAAG9B,6BAA6B,CAAC8B,CAAD,CAAjC;AACA,SAAOA,CAAP;AACD;;AAED,SAASI,kBAAT,CAA4BC,IAA5B,EAAkCC,IAAlC,EAAwC;AACtC,MAAIC,KAAK,GAAGF,IAAI,CAACC,IAAD,CAAJ,KAAeE,SAAf,IAA4B,OAAOH,IAAI,CAACC,IAAD,CAAX,KAAsB,SAA9D;AACA,MAAI,CAACC,KAAL,EAAY/B,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,UAAUC,IAAV,GAAiB,wDAA9B;AACZ,SAAOC,KAAP;AACD;;AAED,SAASG,eAAT,CAAyBL,IAAzB,EAA+BC,IAA/B,EAAqCK,CAArC,EAAwC;AACtC,MAAIJ,KAAK,GAAGF,IAAI,CAACC,IAAD,CAAJ,KAAeE,SAAf,IAA4BG,CAAC,CAACC,OAAF,CAAUP,IAAI,CAACC,IAAD,CAAd,IAAwB,CAAC,CAAjE;AACA,MAAI,CAACC,KAAL,EAAY/B,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,UAAUC,IAAV,GAAiB,mFAAjB,GAAuGK,CAAC,CAACE,GAAF,CAAM,UAAUC,CAAV,EAAa;AACjJ,WAAOC,IAAI,CAACC,SAAL,CAAeF,CAAf,CAAP;AACD,GAF+H,EAE7HG,IAF6H,CAExH,IAFwH,CAAvG,GAET,GAFJ;AAGZ,SAAOV,KAAP;AACD;;AAED,SAASW,iBAAT,CAA2Bb,IAA3B,EAAiCC,IAAjC,EAAuC;AACrC,MAAIC,KAAK,GAAGF,IAAI,CAACC,IAAD,CAAJ,KAAeE,SAAf,IAA4B,OAAOH,IAAI,CAACC,IAAD,CAAX,KAAsB,QAAtB,IAAkC,CAAC,GAAGvB,MAAM,CAACU,OAAX,EAAoBY,IAAI,CAACC,IAAD,CAAxB,EAAgCa,MAAhC,GAAyC,CAAnH;AACA,MAAI,CAACZ,KAAL,EAAY/B,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,UAAUC,IAAV,GAAiB,iEAA9B;AACZ,SAAOC,KAAP;AACD;;AAED,SAASa,gBAAT,CAA0Bf,IAA1B,EAAgCC,IAAhC,EAAsC;AACpC,MAAIC,KAAK,GAAGF,IAAI,CAACC,IAAD,CAAJ,KAAeE,SAAf,IAA4Ba,MAAM,CAACC,KAAP,CAAaC,OAAb,CAAqBlB,IAAI,CAACC,IAAD,CAAzB,CAAxC;AACA,MAAI,CAACC,KAAL,EAAY/B,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,UAAUC,IAAV,GAAiB,uDAA9B;AACZ,SAAOC,KAAP;AACD;;AAED,SAASJ,sBAAT,CAAgCE,IAAhC,EAAsC;AACpC,MAAIxC,sBAAsB,GAAGwC,IAAI,CAACxC,sBAAlC;AAAA,MACInB,yBAAyB,GAAG2D,IAAI,CAAC3D,yBADrC;AAAA,MAEII,kBAAkB,GAAGuD,IAAI,CAACvD,kBAF9B;AAAA,MAGI0E,gBAAgB,GAAGnB,IAAI,CAACmB,gBAH5B;AAAA,MAIIzD,eAAe,GAAGsC,IAAI,CAACtC,eAJ3B;AAAA,MAKID,SAAS,GAAGuC,IAAI,CAACvC,SALrB;AAAA,MAMIf,UAAU,GAAGsD,IAAI,CAACtD,UANtB;AAAA,MAOI0E,aAAa,GAAGpB,IAAI,CAACoB,aAPzB;;AASA,MAAIC,qBAAqB,GAAGC,oBAAoB,CAACtB,IAAD,CAAhD;AAAA,MACIuB,aAAa,GAAGF,qBAAqB,CAACE,aAD1C;AAAA,MAEIC,OAAO,GAAGH,qBAAqB,CAACG,OAFpC;;AAIA,MAAI,CAACnB,eAAe,CAACL,IAAD,EAAO,eAAP,EAAwB,CAAC,OAAD,EAAU,UAAV,CAAxB,CAApB,EAAoE;AAClEoB,IAAAA,aAAa,GAAGjB,SAAhB;AACD;;AAED,MAAI,CAACU,iBAAiB,CAACb,IAAD,EAAO,2BAAP,CAAtB,EAA2D;AACzD3D,IAAAA,yBAAyB,GAAG8D,SAA5B;AACD;;AAED,MAAI,CAACU,iBAAiB,CAACb,IAAD,EAAO,oBAAP,CAAtB,EAAoD;AAClDvD,IAAAA,kBAAkB,GAAG0D,SAArB;AACD;;AAED,MAAI,CAACU,iBAAiB,CAACb,IAAD,EAAO,YAAP,CAAtB,EAA4C;AAC1CtD,IAAAA,UAAU,GAAGyD,SAAb;AACD;;AAED,MAAI,CAACJ,kBAAkB,CAACC,IAAD,EAAO,iBAAP,CAAvB,EAAkD;AAChDtC,IAAAA,eAAe,GAAGyC,SAAlB;AACD;;AAED,MAAI,CAACJ,kBAAkB,CAACC,IAAD,EAAO,WAAP,CAAvB,EAA4C;AAC1CvC,IAAAA,SAAS,GAAG,IAAZ;AACD;;AAED,MAAI,CAACsD,gBAAgB,CAACf,IAAD,EAAO,wBAAP,CAArB,EAAuD;AACrDxC,IAAAA,sBAAsB,GAAG2C,SAAzB;AACD,GAFD,MAEO,IAAI3C,sBAAJ,EAA4B;AACjCA,IAAAA,sBAAsB,GAAGA,sBAAsB,CAACiE,MAAvB,CAA8B,UAAUC,CAAV,EAAajB,CAAb,EAAgB;AACrE,UAAIkB,IAAI,GAAGlB,CAAC,CAACkB,IAAb;AAAA,UACI1B,IAAI,GAAGQ,CAAC,CAACR,IADb;AAAA,UAEIL,OAAO,GAAGa,CAAC,CAACb,OAFhB;AAAA,UAGIgC,WAAW,GAAGnB,CAAC,CAACmB,WAHpB;AAAA,UAIIC,eAAe,GAAGpB,CAAC,CAACoB,eAJxB;AAAA,UAKIC,OAAO,GAAGrB,CAAC,CAACqB,OALhB;AAAA,UAMIC,IAAI,GAAGtB,CAAC,CAACsB,IANb;AAAA,UAOIC,SAAS,GAAGvB,CAAC,CAACuB,SAPlB;AAAA,UAQIC,KAAK,GAAGxB,CAAC,CAACwB,KARd;AAAA,UASIC,OAAO,GAAGzB,CAAC,CAACyB,OAThB;AAWA,UAAIC,MAAM,GAAG,IAAb;AAEA,UAAIC,aAAa,GAAG,CAAC,OAAD,EAAU,UAAV,EAAsB,UAAtB,CAApB;;AACA,UAAI,OAAOnC,IAAP,IAAe,QAAf,IAA2B,CAACA,IAAI,CAACoC,KAAL,CAAW,iBAAX,CAA5B,IAA6DD,aAAa,CAAC7B,OAAd,CAAsBN,IAAtB,IAA8B,CAAC,CAAhG,EAAmG;AACjG9B,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,uUAAuUoC,aAAa,CAACxB,IAAd,CAAmB,IAAnB,CAAvU,GAAkW,GAA/W;AACAuB,QAAAA,MAAM,GAAG,KAAT;AACD;;AAED,UAAIJ,IAAI,KAAK,QAAT,KAAsB,OAAOH,WAAP,IAAsB,QAAtB,IAAkC,CAACA,WAAzD,MAA0E,OAAOC,eAAP,IAA0B,QAA1B,IAAsC,CAACA,eAAjH,CAAJ,EAAuI;AACrI1D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,sDAAsDC,IAAtD,GAA6D,kNAA1E;AACAkC,QAAAA,MAAM,GAAG,KAAT;AACD;;AAED,UAAIN,eAAe,IAAID,WAAvB,EAAoC;AAClCzD,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,kJAAb;AACD;;AAED,UAAI2B,IAAI,IAAIxB,SAAR,KAAsB,OAAOwB,IAAP,IAAe,QAAf,IAA2B,CAACA,IAAlD,CAAJ,EAA6D;AAC3DxD,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,0GAAb;AACA2B,QAAAA,IAAI,GAAGxB,SAAP;AACD;;AAED,UAAI2B,OAAO,IAAI3B,SAAX,KAAyB,OAAO2B,OAAP,IAAkB,QAAlB,IAA8B,CAACA,OAAxD,KAAoE,OAAOA,OAAP,IAAkB,UAA1F,EAAsG;AACpG3D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,2HAAb;AACA8B,QAAAA,OAAO,GAAG3B,SAAV;AACD;;AAED,UAAImC,KAAK,GAAG,CAAC,QAAD,EAAW,MAAX,EAAmB,UAAnB,EAA+B,QAA/B,CAAZ;;AACA,UAAIP,IAAI,IAAI5B,SAAR,KAAsB,OAAO4B,IAAP,IAAe,QAAf,IAA2BO,KAAK,CAAC/B,OAAN,CAAcwB,IAAd,MAAwB,CAAC,CAA1E,CAAJ,EAAkF;AAChF5D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,yHAAyHsC,KAAK,CAAC1B,IAAN,CAAW,MAAX,CAAzH,GAA8I,IAA3J;AACAmB,QAAAA,IAAI,GAAG5B,SAAP;AACD;;AAED,UAAI6B,SAAS,IAAI7B,SAAb,IAA0B4B,IAAI,KAAK,QAAvC,EAAiD;AAC/C5D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,kJAAb;AACAgC,QAAAA,SAAS,GAAG7B,SAAZ;AACD;;AAED,UAAI6B,SAAS,IAAI7B,SAAb,IAA0B,OAAO6B,SAAP,IAAoB,UAAlD,EAA8D;AAC5D7D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,uGAAb;AACAgC,QAAAA,SAAS,GAAG7B,SAAZ;AACD;;AAED,UAAIP,OAAO,IAAIO,SAAX,IAAwB4B,IAAI,IAAI,QAApC,EAA8C;AAC5C5D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,2HAAb;AACAJ,QAAAA,OAAO,GAAGO,SAAV;AACD;;AAED,UAAIP,OAAO,IAAIO,SAAX,IAAwB,CAACa,MAAM,CAACC,KAAP,CAAaC,OAAb,CAAqBtB,OAArB,CAAzB,IAA0D,OAAOA,OAAP,IAAkB,UAA5E,IAA0FmC,IAAI,KAAK,QAAT,IAAqBnC,OAAO,KAAKO,SAA/H,EAA0I;AACxIhC,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,sDAAsDC,IAAtD,GAA6D,+GAA1E;AACAkC,QAAAA,MAAM,GAAG,KAAT;AACD;;AACD,UAAIJ,IAAI,KAAK,QAAT,IAAqB,CAACE,KAA1B,EAAiC;AAC/B9D,QAAAA,CAAC,CAACiC,IAAF,CAAOJ,IAAP,EAAa,sDAAsDC,IAAtD,GAA6D,2EAA1E;AACAkC,QAAAA,MAAM,GAAG,KAAT;AACD;;AAED,aAAOA,MAAM,GAAGT,CAAC,CAACa,MAAF,CAAS,CAAC;AACxBZ,QAAAA,IAAI,EAAEA,IADkB;AAExB1B,QAAAA,IAAI,EAAEA,IAFkB;AAGxBL,QAAAA,OAAO,EAAEA,OAHe;AAIxBgC,QAAAA,WAAW,EAAEA,WAJW;AAKxBC,QAAAA,eAAe,EAAEA,eALO;AAMxBC,QAAAA,OAAO,EAAEA,OANe;AAOxBC,QAAAA,IAAI,EAAEA,IAPkB;AAQxBC,QAAAA,SAAS,EAAEA,SARa;AASxBC,QAAAA,KAAK,EAAEA,KATiB;AAUxBC,QAAAA,OAAO,EAAEA;AAVe,OAAD,CAAT,CAAH,GAWPR,CAXN;AAYD,KAjFwB,EAiFtB,EAjFsB,CAAzB;AAmFAlE,IAAAA,sBAAsB,GAAGQ,WAAW,CAACoB,OAAZ,CAAoBS,MAApB,CAA2BrC,sBAA3B,EAAmDgD,GAAnD,CAAuD,UAAUC,CAAV,EAAa;AAC3F,aAAOA,CAAC,CAAC0B,MAAF,CAAS,UAAUK,CAAV,EAAa;AAC3B,eAAOA,CAAC,KAAKrC,SAAb;AACD,OAFM,CAAP;AAGD,KAJwB,CAAzB;AAKD,GAjImC,CAmIpC;AACA;;;AACAgB,EAAAA,gBAAgB,GAAGA,gBAAgB,KAAK,KAArB,GAA6B,KAA7B,GAAqC,IAAxD;AAEA,SAAO,CAAC,GAAGrD,UAAU,CAAC2E,GAAf,EAAoB;AACzBjF,IAAAA,sBAAsB,EAAEA,sBADC;AAEzBkF,IAAAA,qBAAqB,EAAErG,yBAFE;AAGzBI,IAAAA,kBAAkB,EAAEA,kBAHK;AAIzB8E,IAAAA,aAAa,EAAEA,aAJU;AAKzBJ,IAAAA,gBAAgB,EAAEA,gBALO;AAMzBzD,IAAAA,eAAe,EAAEA,eANQ;AAOzBD,IAAAA,SAAS,EAAEA,SAPc;AAQzB+D,IAAAA,OAAO,EAAEA,OARgB;AASzB9E,IAAAA,UAAU,EAAEA,UATa;AAUzB0E,IAAAA,aAAa,EAAEA;AAVU,GAApB,EAWJe,MAXI,CAWG,UAAU1B,CAAV,EAAa;AACrB,WAAO,OAAOA,CAAP,KAAa,WAApB;AACD,GAbM,EAaJkC,IAbI,EAAP;AAcD;;AAED,SAASrB,oBAAT,CAA8BtB,IAA9B,EAAoC;AAClC,MAAI4C,QAAQ,GAAGC,SAAS,CAAC/B,MAAV,GAAmB,CAAnB,IAAwB+B,SAAS,CAAC,CAAD,CAAT,KAAiB1C,SAAzC,GAAqD0C,SAAS,CAAC,CAAD,CAA9D,GAAoE;AACjFC,IAAAA,UAAU,EAAE,IADqE;AAEjFC,IAAAA,WAAW,EAAE,IAFoE;AAGjFC,IAAAA,mBAAmB,EAAE,IAH4D;AAIjFzB,IAAAA,aAAa,EAAEpB;AAJkE,GAAnF;AAMA,MAAI6C,mBAAmB,GAAGhD,IAAI,CAACgD,mBAA/B;AAAA,MACIF,UAAU,GAAG9C,IAAI,CAAC8C,UADtB;AAAA,MAEIC,WAAW,GAAG/C,IAAI,CAAC+C,WAFvB;AAAA,MAGIxB,aAAa,GAAGvB,IAAI,CAACuB,aAHzB;AAMA,MAAIC,OAAO,GAAG,EAAd;;AAEA,MAAIsB,UAAU,KAAK,IAAf,IAAuB,CAAC/C,kBAAkB,CAACC,IAAD,EAAO,YAAP,CAAnB,IAA2C4C,QAAQ,CAACE,UAA3E,IAAyFA,UAAU,KAAK3C,SAAf,IAA4ByC,QAAQ,CAACE,UAAlI,EAA8I;AAC5ItB,IAAAA,OAAO,CAACyB,IAAR,CAAa,OAAb;AACD;;AAED,MAAIF,WAAW,KAAK,IAAhB,IAAwB,CAAChD,kBAAkB,CAACC,IAAD,EAAO,aAAP,CAAnB,IAA4C4C,QAAQ,CAACG,WAA7E,IAA4FA,WAAW,KAAK5C,SAAhB,IAA6ByC,QAAQ,CAACG,WAAtI,EAAmJ;AACjJvB,IAAAA,OAAO,CAACyB,IAAR,CAAa,QAAb;AACD;;AAED,MAAID,mBAAmB,KAAK,IAAxB,IAAgC,CAACjD,kBAAkB,CAACC,IAAD,EAAO,qBAAP,CAAnB,IAAoD4C,QAAQ,CAACI,mBAA7F,IAAoHA,mBAAmB,KAAK7C,SAAxB,IAAqCyC,QAAQ,CAACI,mBAAtK,EAA2L;AACzLxB,IAAAA,OAAO,CAACyB,IAAR,CAAa,gBAAb;AACD;;AAEDzB,EAAAA,OAAO,CAACyB,IAAR,CAAa,UAAb;;AAEA,MAAI,CAAC5C,eAAe,CAACL,IAAD,EAAO,eAAP,EAAwBwB,OAAxB,CAApB,EAAsD;AACpDD,IAAAA,aAAa,GAAGpB,SAAhB;AACD;;AAED,MAAIoB,aAAa,KAAKpB,SAAtB,EAAiC;AAC/BoB,IAAAA,aAAa,GAAGqB,QAAQ,CAACrB,aAAT,IAA0BC,OAAO,CAAC,CAAD,CAAjD;AACD;;AAED,SAAO;AAAED,IAAAA,aAAa,EAAEA,aAAjB;AAAgCC,IAAAA,OAAO,EAAE,IAAI1D,UAAU,CAACoF,IAAf,CAAoB1B,OAApB;AAAzC,GAAP;AACD;;AAED,SAASpF,uBAAT,CAAiCuD,CAAjC,EAAoCK,IAApC,EAA0C;AACxC,MAAImD,sBAAsB,GAAG7B,oBAAoB,CAACtB,IAAD,EAAO;AACtD8C,IAAAA,UAAU,EAAEjG,gBAAgB,CAAC8C,CAAD,CAAhB,CAAoByD,QAApB,CAA6B,OAA7B,CAD0C;AAEtDL,IAAAA,WAAW,EAAElG,gBAAgB,CAAC8C,CAAD,CAAhB,CAAoByD,QAApB,CAA6B,QAA7B,CAFyC;AAGtDJ,IAAAA,mBAAmB,EAAEnG,gBAAgB,CAAC8C,CAAD,CAAhB,CAAoByD,QAApB,CAA6B,gBAA7B,CAHiC;AAItD7B,IAAAA,aAAa,EAAEhC,GAAG,CAACI,CAAD,EAAI,eAAJ;AAJoC,GAAP,CAAjD;AAAA,MAMI4B,aAAa,GAAG4B,sBAAsB,CAAC5B,aAN3C;AAAA,MAOIC,OAAO,GAAG2B,sBAAsB,CAAC3B,OAPrC;;AASA7B,EAAAA,CAAC,GAAGD,IAAI,CAACC,CAAD,EAAI,eAAJ,EAAqB4B,aAArB,CAAR;AACA5B,EAAAA,CAAC,GAAGD,IAAI,CAACC,CAAD,EAAI,SAAJ,EAAe6B,OAAf,CAAR;AACA,SAAO7B,CAAP;AACD;;AAED,SAAStD,yBAAT,CAAmCsD,CAAnC,EAAsC;AACpC,MAAIM,IAAI,GAAG3D,6BAA6B,CAACqD,CAAD,CAAxC;AACA,SAAOM,IAAI,IAAI9B,CAAC,CAACkF,cAAF,CAAiB1D,CAAjB,EAAoBM,IAApB,CAAf;AACD;;AAED,SAAS3D,6BAAT,CAAuCqD,CAAvC,EAA0C;AACxC,SAAOJ,GAAG,CAACI,CAAD,EAAI,uBAAJ,CAAV;AACD;;AAED,SAASpD,kBAAT,CAA4BoD,CAA5B,EAA+B;AAC7B,SAAOxB,CAAC,CAACmF,kBAAF,CAAqB3D,CAArB,KAA2B,CAAC,GAAGhB,OAAO,CAAC4E,gBAAZ,EAA8B5D,CAA9B,CAA3B,IAA+DtD,yBAAyB,CAACsD,CAAD,CAAxF,IAA+FxB,CAAC,CAACqF,UAAF,CAAa7D,CAAb,EAAgB,UAAhB,CAAtG;AACD;;AAED,SAASnD,sBAAT,CAAgCmD,CAAhC,EAAmC;AACjC,SAAO,CAACpD,kBAAkB,CAACoD,CAAD,CAAlB,IAAyB,CAAC,GAAG7B,UAAU,CAAC2E,GAAf,GAA1B,EAAiDlD,GAAjD,CAAqD,MAArD,CAAP;AACD;;AAED,SAAS9C,kBAAT,CAA4BkD,CAA5B,EAA+B;AAC7B,MAAI8D,QAAQ,GAAGZ,SAAS,CAAC/B,MAAV,GAAmB,CAAnB,IAAwB+B,SAAS,CAAC,CAAD,CAAT,KAAiB1C,SAAzC,GAAqD0C,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAnF;AAEA,SAAOtD,GAAG,CAACI,CAAD,EAAI,oBAAJ,EAA0B8D,QAA1B,CAAV;AACD;;AAED,SAAS/G,UAAT,CAAoBiD,CAApB,EAAuB;AACrB,MAAI8D,QAAQ,GAAGZ,SAAS,CAAC/B,MAAV,GAAmB,CAAnB,IAAwB+B,SAAS,CAAC,CAAD,CAAT,KAAiB1C,SAAzC,GAAqD0C,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAnF;AAEA,SAAOtD,GAAG,CAACI,CAAD,EAAI,YAAJ,EAAkB8D,QAAlB,CAAV;AACD;;AAED,SAAS9G,SAAT,CAAmBgD,CAAnB,EAAsBM,IAAtB,EAA4B;AAC1B,MAAIyD,MAAM,GAAGb,SAAS,CAAC/B,MAAV,GAAmB,CAAnB,IAAwB+B,SAAS,CAAC,CAAD,CAAT,KAAiB1C,SAAzC,GAAqD0C,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAjF,CAD0B,CAG1B;AACA;AACA;;AACAlD,EAAAA,CAAC,GAAGxB,CAAC,CAACwF,gBAAF,CAAmBhE,CAAnB,CAAJ;AACAA,EAAAA,CAAC,GAAGxB,CAAC,CAACyF,kBAAF,CAAqBjE,CAArB,CAAJ;AACAA,EAAAA,CAAC,GAAG,CAAC,GAAGtB,OAAO,CAACwF,iBAAZ,EAA+BlE,CAA/B,EAAkC+D,MAAlC,CAAJ;AACA/D,EAAAA,CAAC,GAAG,CAAC,GAAGtB,OAAO,CAACyF,WAAZ,EAAyBnE,CAAzB,EAA4B+D,MAA5B,CAAJ;AAEA,SAAOhE,IAAI,CAACC,CAAD,EAAI,QAAJ,EAAcM,IAAd,CAAX;AACD;;AAED,SAASrD,SAAT,CAAmB+C,CAAnB,EAAsB;AACpB,MAAIoE,MAAM,GAAGtE,IAAI,CAACE,CAAD,EAAI,QAAJ,CAAjB;AACA,MAAI4B,aAAa,GAAGzE,gBAAgB,CAAC6C,CAAD,CAApC;AACA,MAAI6B,OAAO,GAAG,CAACuC,MAAD,EAASxC,aAAT,EAAwB,OAAxB,EAAiC,QAAjC,EAA2C,gBAA3C,EAA6D,UAA7D,CAAd;AACA,MAAI1E,gBAAgB,GAAG2E,OAAO,CAACW,MAAR,CAAe,UAAU1B,CAAV,EAAa;AACjD,WAAOpD,SAAS,CAACsC,CAAD,EAAIc,CAAJ,CAAhB;AACD,GAFsB,CAAvB;AAGA,SAAO5D,gBAAgB,CAAC,CAAD,CAAvB;AACD;;AAED,SAASA,gBAAT,CAA0B8C,CAA1B,EAA6B;AAC3B,SAAOF,IAAI,CAACE,CAAD,EAAI,SAAJ,CAAJ,IAAsBJ,GAAG,CAACI,CAAD,EAAI,SAAJ,EAAe,IAAI7B,UAAU,CAACoF,IAAf,EAAf,CAAhC;AACD;;AAED,SAASpG,gBAAT,CAA0B6C,CAA1B,EAA6B;AAC3B,SAAOF,IAAI,CAACE,CAAD,EAAI,eAAJ,CAAJ,IAA4BJ,GAAG,CAACI,CAAD,EAAI,eAAJ,CAAtC;AACD;;AAED,SAAS5C,gBAAT,CAA0B4C,CAA1B,EAA6BqE,GAA7B,EAAkC;AAChC,SAAOlH,gBAAgB,CAAC6C,CAAD,CAAhB,KAAwBqE,GAA/B;AACD;;AAED,SAAShH,kCAAT,CAA4C2C,CAA5C,EAA+C;AAC7C,SAAO,CAACpD,kBAAkB,CAACoD,CAAD,CAAlB,IAAyB,CAAC,GAAG7B,UAAU,CAAC2E,GAAf,GAA1B,EAAiDE,IAAjD,GAAwDsB,eAA/D;AACD;;AAED,SAAShH,qBAAT,CAA+B0C,CAA/B,EAAkC;AAChC,MAAIxB,CAAC,CAAC+F,kBAAF,CAAqBvE,CAArB,EAAwB,UAAxB,CAAJ,EAAyC;AACvC,WAAO3C,kCAAkC,CAAC2C,CAAD,CAAlC,GAAwCJ,GAAG,CAACI,CAAD,EAAI,eAAJ,EAAqB,KAArB,CAA3C,GAAyE,OAAhF;AACD;;AAED,SAAOxB,CAAC,CAAC+F,kBAAF,CAAqBvE,CAArB,EAAwB,YAAxB,KAAyC,CAAC,GAAGf,WAAW,CAACuF,6BAAhB,EAA+CxE,CAA/C,CAAzC,GAA6F,UAA7F,GAA0G,OAAjH;AACD;;AAED,SAASzC,sBAAT,CAAgCyC,CAAhC,EAAmC;AACjC,SAAO1C,qBAAqB,CAAC0C,CAAD,CAArB,KAA6B,OAApC;AACD;;AAED,SAASxC,qBAAT,CAA+BwC,CAA/B,EAAkC;AAChC,MAAIC,OAAO,GAAGiD,SAAS,CAAC/B,MAAV,GAAmB,CAAnB,IAAwB+B,SAAS,CAAC,CAAD,CAAT,KAAiB1C,SAAzC,GAAqD0C,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAlF;AAEA,MAAIuB,WAAW,GAAGlH,sBAAsB,CAACyC,CAAD,CAAxC;;AACA,MAAIyE,WAAJ,EAAiB;AACf,WAAO,CAAC,GAAG/F,OAAO,CAACgG,aAAZ,EAA2B1E,CAA3B,EAA8B,OAA9B,CAAP;AACD;;AACD,MAAIC,OAAO,CAAC0E,UAAZ,EAAwB;AACtB,WAAO,CAAC,GAAGjG,OAAO,CAACgG,aAAZ,EAA2B1E,CAA3B,EAA8B,OAA9B,KAA0C,CAAC,GAAGtB,OAAO,CAACgG,aAAZ,EAA2B1E,CAA3B,EAA8B,UAA9B,CAAjD;AACD;;AACD,SAAO,CAAC,GAAGtB,OAAO,CAACgG,aAAZ,EAA2B1E,CAA3B,EAA8B,UAA9B,KAA6C,CAAC,GAAGtB,OAAO,CAACgG,aAAZ,EAA2B1E,CAA3B,EAA8B,OAA9B,CAApD;AACD;;AAED,SAASvC,gBAAT,CAA0BuC,CAA1B,EAA6B;AAC3B,SAAO3C,kCAAkC,CAAC2C,CAAD,CAAlC,IAAyCJ,GAAG,CAACI,CAAD,EAAI,eAAJ,EAAqB,OAArB,CAAH,KAAqC,UAArF;AACD;;AAED,SAAStC,SAAT,CAAmBsC,CAAnB,EAAsB4E,CAAtB,EAAyB;AACvB,MAAIC,KAAK,GAAG,CAACjI,kBAAkB,CAACoD,CAAD,CAAlB,IAAyB,CAAC,GAAG7B,UAAU,CAAC2E,GAAf,GAA1B,EAAiDE,IAAjD,EAAZ;AAAA,MACI8B,WAAW,GAAGD,KAAK,CAACC,WADxB;AAAA,MAEIC,WAAW,GAAGF,KAAK,CAACE,WAFxB;;AAIA,SAAO,EAAED,WAAW,KAAK,KAAhB,IAAyBF,CAAC,KAAK,gBAAjC,KAAsD,EAAEG,WAAW,KAAK,KAAhB,IAAyBH,CAAC,KAAK,QAAjC,CAAtD,IAAoG1H,gBAAgB,CAAC8C,CAAD,CAAhB,CAAoByD,QAApB,CAA6BmB,CAA7B,CAA3G;AACD;;AAED,SAASjH,eAAT,CAAyBqC,CAAzB,EAA4B;AAC1B,SAAOJ,GAAG,CAACI,CAAD,EAAI,kBAAJ,CAAV;AACD;;AAED,SAASpC,sBAAT,CAAgCoC,CAAhC,EAAmC;AACjC,SAAO,CAACpD,kBAAkB,CAACoD,CAAD,CAAlB,IAAyB,CAAC,GAAG7B,UAAU,CAAC2E,GAAf,GAA1B,EAAiDlD,GAAjD,CAAqD,gBAArD,EAAuE,MAAvE,CAAP;AACD;;AAED,SAAS/B,sBAAT,CAAgCmC,CAAhC,EAAmC;AACjC,SAAOJ,GAAG,CAACI,CAAD,EAAI,wBAAJ,EAA8B,CAAC,GAAG7B,UAAU,CAACoF,IAAf,GAA9B,CAAV;AACD;;AAED,SAASzF,SAAT,CAAmBkC,CAAnB,EAAsB;AACpB,SAAOJ,GAAG,CAACI,CAAD,EAAI,WAAJ,EAAiB,IAAjB,CAAV;AACD;;AAED,SAASjC,eAAT,CAAyBiC,CAAzB,EAA4B;AAC1B,SAAOJ,GAAG,CAACI,CAAD,EAAI,iBAAJ,EAAuB,KAAvB,CAAV;AACD;;AAED,SAAShC,aAAT,CAAuBgC,CAAvB,EAA0B;AACxB,SAAO,CAACjC,eAAe,CAACiC,CAAD,CAAhB,IAAuBF,IAAI,CAACE,CAAD,EAAI,eAAJ,EAAqB,KAArB,CAAlC;AACD;;AAED,SAAS/B,qBAAT,CAA+B+B,CAA/B,EAAkC;AAChC,SAAOD,IAAI,CAACC,CAAD,EAAI,eAAJ,EAAqB,CAAChC,aAAa,CAACgC,CAAD,CAAnC,CAAX;AACD;;AAED,SAAS9B,6BAAT,CAAuC8B,CAAvC,EAA0C;AACxC,SAAOnC,sBAAsB,CAACmC,CAAD,CAAtB,CAA0B8B,MAA1B,CAAiC,UAAUC,CAAV,EAAajB,CAAb,EAAgB;AACtD,YAAQA,CAAC,CAAClB,GAAF,CAAM,MAAN,CAAR;AACE,WAAK,QAAL;AACE,eAAOoF,kCAAkC,CAACjD,CAAD,EAAIjB,CAAJ,CAAzC;;AACF,WAAK,QAAL;AACE,eAAOmE,kCAAkC,CAAClD,CAAD,EAAIjB,CAAJ,CAAzC;;AACF;AACE,eAAOoE,gCAAgC,CAACnD,CAAD,EAAIjB,CAAJ,CAAvC;AANJ;AAQD,GATM,EASJd,CATI,CAAP;AAUD;;AAED,SAASgF,kCAAT,CAA4ChF,CAA5C,EAA+Cc,CAA/C,EAAkD;AAChD,MAAIR,IAAI,GAAGQ,CAAC,CAAClB,GAAF,CAAM,MAAN,CAAX;AACA,MAAIuF,KAAK,GAAG,CAAC,uBAAD,EAA0B7E,IAA1B,CAAZ;AACA,MAAI6B,OAAO,GAAGrB,CAAC,CAAClB,GAAF,CAAM,SAAN,CAAd;AACA,MAAIK,OAAO,GAAGa,CAAC,CAAClB,GAAF,CAAM,SAAN,CAAd;AAEA,MAAIwF,eAAe,GAAG,OAAOjD,OAAP,KAAmB,UAAnB,GAAgC3B,SAAhC,GAA4C2B,OAAO,IAAI,EAA7E;AACA,MAAIkD,eAAe,GAAG,OAAOpF,OAAP,KAAmB,UAAnB,GAAgCO,SAAhC,GAA4CP,OAAlE;;AAEA,MAAIqF,QAAQ,GAAG,SAASA,QAAT,CAAkBtF,CAAlB,EAAqB;AAClC,WAAOoF,eAAe,KAAK5E,SAApB,IAAiC6E,eAAe,KAAK7E,SAArD,GAAiE,CAAC,GAAG9B,OAAO,CAAC6G,mBAAZ,EAAiCvF,CAAjC,EAAoCM,IAApC,EAA0CjC,WAAW,CAACoB,OAAZ,CAAoBS,MAApB,CAA2BmF,eAA3B,CAA1C,EAAuFD,eAAvF,CAAjE,GAA2KpF,CAAlL;AACD,GAFD;;AAIA,MAAIoF,eAAe,KAAK5E,SAAxB,EAAmC;AACjCR,IAAAA,CAAC,GAAG,CAAC,GAAGnB,MAAM,CAACY,OAAX,EAAoBO,CAApB,EAAuBmF,KAAK,CAACvC,MAAN,CAAa,SAAb,CAAvB,EAAgD;AAClD4C,MAAAA,aAAa,EAAE,EADmC;AAElDC,MAAAA,SAAS,EAAE,SAASA,SAAT,CAAmBzF,CAAnB,EAAsB0F,MAAtB,EAA8B;AACvCN,QAAAA,eAAe,GAAGM,MAAlB;AACA,eAAOJ,QAAQ,CAACtF,CAAD,CAAf;AACD,OALiD;AAMlD2F,MAAAA,MAAM,EAAE,SAASA,MAAT,CAAgB3F,CAAhB,EAAmB4F,EAAnB,EAAuB;AAC7B,eAAOzD,OAAO,CAACyD,EAAD,CAAd;AACD;AARiD,KAAhD,CAAJ;AAUD;;AAED,MAAIP,eAAe,KAAK7E,SAAxB,EAAmC;AACjCR,IAAAA,CAAC,GAAG,CAAC,GAAGnB,MAAM,CAACY,OAAX,EAAoBO,CAApB,EAAuBmF,KAAK,CAACvC,MAAN,CAAa,SAAb,CAAvB,EAAgD;AAClD6C,MAAAA,SAAS,EAAE,SAASA,SAAT,CAAmBzF,CAAnB,EAAsB0F,MAAtB,EAA8B;AACvCL,QAAAA,eAAe,GAAGK,MAAlB;AACA,eAAOJ,QAAQ,CAACtF,CAAD,CAAf;AACD,OAJiD;AAKlD2F,MAAAA,MAAM,EAAE,SAASA,MAAT,CAAgB3F,CAAhB,EAAmB4F,EAAnB,EAAuB;AAC7B,eAAO3F,OAAO,CAAC2F,EAAD,CAAd;AACD;AAPiD,KAAhD,CAAJ;AASD;;AAED,MAAIR,eAAe,KAAK5E,SAApB,IAAiC6E,eAAe,KAAK7E,SAAzD,EAAoE;AAClER,IAAAA,CAAC,GAAG,CAAC,GAAGtB,OAAO,CAAC6G,mBAAZ,EAAiCvF,CAAjC,EAAoCM,IAApC,EAA0CjC,WAAW,CAACoB,OAAZ,CAAoBS,MAApB,CAA2BmF,eAA3B,CAA1C,EAAuFD,eAAvF,CAAJ;AACD;;AAED,SAAOpF,CAAP;AACD;;AAED,SAASkF,gCAAT,CAA0ClF,CAA1C,EAA6Cc,CAA7C,EAAgD;AAC9C,MAAIR,IAAI,GAAGQ,CAAC,CAAClB,GAAF,CAAM,MAAN,CAAX;AACA,MAAIR,GAAG,GAAG,CAAC,uBAAD,EAA0BkB,IAA1B,EAAgC,SAAhC,CAAV;AACA,MAAI6B,OAAO,GAAGrB,CAAC,CAAClB,GAAF,CAAM,SAAN,CAAd;AACA,MAAIyC,SAAS,GAAGvB,CAAC,CAAClB,GAAF,CAAM,WAAN,CAAhB;AAEA,MAAIwF,eAAe,GAAG,OAAOjD,OAAP,KAAmB,UAAnB,GAAgC3B,SAAhC,GAA4C2B,OAAO,IAAI,EAA7E;;AAEA,MAAIiD,eAAe,KAAK5E,SAAxB,EAAmC;AACjCR,IAAAA,CAAC,GAAG,CAAC,GAAGnB,MAAM,CAACY,OAAX,EAAoBO,CAApB,EAAuBZ,GAAvB,EAA4B;AAC9BoG,MAAAA,aAAa,EAAE,EADe;AAE9BC,MAAAA,SAAS,EAAE,SAASA,SAAT,CAAmBzF,CAAnB,EAAsB0F,MAAtB,EAA8B;AACvC,eAAO,CAAC,GAAGhH,OAAO,CAACmH,QAAZ,EAAsB7F,CAAtB,EAAyBM,IAAzB,EAA+BoF,MAA/B,EAAuCrD,SAAvC,CAAP;AACD,OAJ6B;AAK9BsD,MAAAA,MAAM,EAAE,SAASA,MAAT,CAAgB3F,CAAhB,EAAmB4F,EAAnB,EAAuB;AAC7B,eAAOzD,OAAO,CAACyD,EAAD,CAAd;AACD;AAP6B,KAA5B,CAAJ;AASD,GAVD,MAUO;AACL5F,IAAAA,CAAC,GAAG,CAAC,GAAGtB,OAAO,CAACmH,QAAZ,EAAsB7F,CAAtB,EAAyBM,IAAzB,EAA+B8E,eAA/B,EAAgD/C,SAAhD,CAAJ;AACD;;AAED,SAAOrC,CAAP;AACD;;AAED,SAASiF,kCAAT,CAA4CjF,CAA5C,EAA+Cc,CAA/C,EAAkD;AAChD,SAAO,CAAC,GAAGpC,OAAO,CAACmH,QAAZ,EAAsB7F,CAAtB,EAAyBc,CAAC,CAAClB,GAAF,CAAM,MAAN,CAAzB,EAAwCkB,CAAC,CAAClB,GAAF,CAAM,OAAN,CAAxC,CAAP;AACD","sourcesContent":["'use strict';\n\nexports.__esModule = true;\nexports.initDatabase = initDatabase;\nexports.overrideDatabaseOptions = overrideDatabaseOptions;\nexports.defaultDatabaseConnection = defaultDatabaseConnection;\nexports.defaultDatabaseConnectionName = defaultDatabaseConnectionName;\nexports.databaseConnection = databaseConnection;\nexports.databaseConnectionName = databaseConnectionName;\nexports.forgotPasswordLink = forgotPasswordLink;\nexports.signUpLink = signUpLink;\nexports.setScreen = setScreen;\nexports.getScreen = getScreen;\nexports.availableScreens = availableScreens;\nexports.getInitialScreen = getInitialScreen;\nexports.hasInitialScreen = hasInitialScreen;\nexports.databaseConnectionRequiresUsername = databaseConnectionRequiresUsername;\nexports.databaseUsernameStyle = databaseUsernameStyle;\nexports.databaseLogInWithEmail = databaseLogInWithEmail;\nexports.databaseUsernameValue = databaseUsernameValue;\nexports.authWithUsername = authWithUsername;\nexports.hasScreen = hasScreen;\nexports.shouldAutoLogin = shouldAutoLogin;\nexports.passwordStrengthPolicy = passwordStrengthPolicy;\nexports.additionalSignUpFields = additionalSignUpFields;\nexports.showTerms = showTerms;\nexports.mustAcceptTerms = mustAcceptTerms;\nexports.termsAccepted = termsAccepted;\nexports.toggleTermsAcceptance = toggleTermsAcceptance;\nexports.resolveAdditionalSignUpFields = resolveAdditionalSignUpFields;\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _index = require('../../core/index');\n\nvar l = _interopRequireWildcard(_index);\n\nvar _index2 = require('../../field/index');\n\nvar _data_utils = require('../../utils/data_utils');\n\nvar _sync = require('../../sync');\n\nvar _sync2 = _interopRequireDefault(_sync);\n\nvar _trim = require('trim');\n\nvar _trim2 = _interopRequireDefault(_trim);\n\nvar _tenant = require('../../core/tenant');\n\nvar _enterprise = require('../../connection/enterprise');\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _dataFns = (0, _data_utils.dataFns)(['database']),\n    get = _dataFns.get,\n    initNS = _dataFns.initNS,\n    tget = _dataFns.tget,\n    tset = _dataFns.tset;\n\nfunction initDatabase(m, options) {\n  m = initNS(m, _immutable2.default.fromJS(processDatabaseOptions(options)));\n  m = resolveAdditionalSignUpFields(m);\n  return m;\n}\n\nfunction assertMaybeBoolean(opts, name) {\n  var valid = opts[name] === undefined || typeof opts[name] === 'boolean';\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not a booelan.');\n  return valid;\n}\n\nfunction assertMaybeEnum(opts, name, a) {\n  var valid = opts[name] === undefined || a.indexOf(opts[name]) > -1;\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not one of the following allowed values: ' + a.map(function (x) {\n    return JSON.stringify(x);\n  }).join(', ') + '.');\n  return valid;\n}\n\nfunction assertMaybeString(opts, name) {\n  var valid = opts[name] === undefined || typeof opts[name] === 'string' && (0, _trim2.default)(opts[name]).length > 0;\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not a non-empty string.');\n  return valid;\n}\n\nfunction assertMaybeArray(opts, name) {\n  var valid = opts[name] === undefined || global.Array.isArray(opts[name]);\n  if (!valid) l.warn(opts, 'The `' + name + '` option will be ignored, because it is not an array.');\n  return valid;\n}\n\nfunction processDatabaseOptions(opts) {\n  var additionalSignUpFields = opts.additionalSignUpFields,\n      defaultDatabaseConnection = opts.defaultDatabaseConnection,\n      forgotPasswordLink = opts.forgotPasswordLink,\n      loginAfterSignUp = opts.loginAfterSignUp,\n      mustAcceptTerms = opts.mustAcceptTerms,\n      showTerms = opts.showTerms,\n      signUpLink = opts.signUpLink,\n      usernameStyle = opts.usernameStyle;\n\n  var _processScreenOptions = processScreenOptions(opts),\n      initialScreen = _processScreenOptions.initialScreen,\n      screens = _processScreenOptions.screens;\n\n  if (!assertMaybeEnum(opts, 'usernameStyle', ['email', 'username'])) {\n    usernameStyle = undefined;\n  }\n\n  if (!assertMaybeString(opts, 'defaultDatabaseConnection')) {\n    defaultDatabaseConnection = undefined;\n  }\n\n  if (!assertMaybeString(opts, 'forgotPasswordLink')) {\n    forgotPasswordLink = undefined;\n  }\n\n  if (!assertMaybeString(opts, 'signUpLink')) {\n    signUpLink = undefined;\n  }\n\n  if (!assertMaybeBoolean(opts, 'mustAcceptTerms')) {\n    mustAcceptTerms = undefined;\n  }\n\n  if (!assertMaybeBoolean(opts, 'showTerms')) {\n    showTerms = true;\n  }\n\n  if (!assertMaybeArray(opts, 'additionalSignUpFields')) {\n    additionalSignUpFields = undefined;\n  } else if (additionalSignUpFields) {\n    additionalSignUpFields = additionalSignUpFields.reduce(function (r, x) {\n      var icon = x.icon,\n          name = x.name,\n          options = x.options,\n          placeholder = x.placeholder,\n          placeholderHTML = x.placeholderHTML,\n          prefill = x.prefill,\n          type = x.type,\n          validator = x.validator,\n          value = x.value,\n          storage = x.storage;\n\n      var filter = true;\n\n      var reservedNames = ['email', 'username', 'password'];\n      if (typeof name != 'string' || !name.match(/^[a-zA-Z0-9_]+$/) || reservedNames.indexOf(name) > -1) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` because it does not contain valid `name` property. Every element of `additionalSignUpFields` must be an object with a `name` property that is a non-empty string consisting of letters, numbers and underscores. The following names are reserved, and therefore, cannot be used: ' + reservedNames.join(', ') + '.');\n        filter = false;\n      }\n\n      if (type !== 'hidden' && (typeof placeholder != 'string' || !placeholder) && (typeof placeholderHTML != 'string' || !placeholderHTML)) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` (' + name + ') because it does not contain a valid `placeholder` or `placeholderHTML` property. Every element of `additionalSignUpFields` must have a `placeholder` or `placeholderHTML` property that is a non-empty string.');\n        filter = false;\n      }\n\n      if (placeholderHTML && placeholder) {\n        l.warn(opts, 'When provided, the `placeholderHTML` property of an element of `additionalSignUpFields` will override the `placeholder` property of that element');\n      }\n\n      if (icon != undefined && (typeof icon != 'string' || !icon)) {\n        l.warn(opts, 'When provided, the `icon` property of an element of `additionalSignUpFields` must be a non-empty string.');\n        icon = undefined;\n      }\n\n      if (prefill != undefined && (typeof prefill != 'string' || !prefill) && typeof prefill != 'function') {\n        l.warn(opts, 'When provided, the `prefill` property of an element of `additionalSignUpFields` must be a non-empty string or a function.');\n        prefill = undefined;\n      }\n\n      var types = ['select', 'text', 'checkbox', 'hidden'];\n      if (type != undefined && (typeof type != 'string' || types.indexOf(type) === -1)) {\n        l.warn(opts, 'When provided, the `type` property of an element of `additionalSignUpFields` must be one of the following strings: \"' + types.join('\", \"') + '\".');\n        type = undefined;\n      }\n\n      if (validator != undefined && type === 'select') {\n        l.warn(opts, 'Elements of `additionalSignUpFields` with a \"select\" `type` cannot specify a `validator` function, all of its `options` are assumed to be valid.');\n        validator = undefined;\n      }\n\n      if (validator != undefined && typeof validator != 'function') {\n        l.warn(opts, 'When provided, the `validator` property of an element of `additionalSignUpFields` must be a function.');\n        validator = undefined;\n      }\n\n      if (options != undefined && type != 'select') {\n        l.warn(opts, 'The `options` property can only by provided for an element of `additionalSignUpFields` when its `type` equals to \"select\"');\n        options = undefined;\n      }\n\n      if (options != undefined && !global.Array.isArray(options) && typeof options != 'function' || type === 'select' && options === undefined) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` (' + name + ') because it has a \"select\" `type` but does not specify an `options` property that is an Array or a function.');\n        filter = false;\n      }\n      if (type === 'hidden' && !value) {\n        l.warn(opts, 'Ignoring an element of `additionalSignUpFields` (' + name + ') because it has a \"hidden\" `type` but does not specify a `value` string.');\n        filter = false;\n      }\n\n      return filter ? r.concat([{\n        icon: icon,\n        name: name,\n        options: options,\n        placeholder: placeholder,\n        placeholderHTML: placeholderHTML,\n        prefill: prefill,\n        type: type,\n        validator: validator,\n        value: value,\n        storage: storage\n      }]) : r;\n    }, []);\n\n    additionalSignUpFields = _immutable2.default.fromJS(additionalSignUpFields).map(function (x) {\n      return x.filter(function (y) {\n        return y !== undefined;\n      });\n    });\n  }\n\n  // TODO: add a warning if it is not a boolean, leave it undefined,\n  // and change accessor fn.\n  loginAfterSignUp = loginAfterSignUp === false ? false : true;\n\n  return (0, _immutable.Map)({\n    additionalSignUpFields: additionalSignUpFields,\n    defaultConnectionName: defaultDatabaseConnection,\n    forgotPasswordLink: forgotPasswordLink,\n    initialScreen: initialScreen,\n    loginAfterSignUp: loginAfterSignUp,\n    mustAcceptTerms: mustAcceptTerms,\n    showTerms: showTerms,\n    screens: screens,\n    signUpLink: signUpLink,\n    usernameStyle: usernameStyle\n  }).filter(function (x) {\n    return typeof x !== 'undefined';\n  }).toJS();\n}\n\nfunction processScreenOptions(opts) {\n  var defaults = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    allowLogin: true,\n    allowSignUp: true,\n    allowForgotPassword: true,\n    initialScreen: undefined\n  };\n  var allowForgotPassword = opts.allowForgotPassword,\n      allowLogin = opts.allowLogin,\n      allowSignUp = opts.allowSignUp,\n      initialScreen = opts.initialScreen;\n\n\n  var screens = [];\n\n  if (allowLogin === true || !assertMaybeBoolean(opts, 'allowLogin') && defaults.allowLogin || allowLogin === undefined && defaults.allowLogin) {\n    screens.push('login');\n  }\n\n  if (allowSignUp === true || !assertMaybeBoolean(opts, 'allowSignUp') && defaults.allowSignUp || allowSignUp === undefined && defaults.allowSignUp) {\n    screens.push('signUp');\n  }\n\n  if (allowForgotPassword === true || !assertMaybeBoolean(opts, 'allowForgotPassword') && defaults.allowForgotPassword || allowForgotPassword === undefined && defaults.allowForgotPassword) {\n    screens.push('forgotPassword');\n  }\n\n  screens.push('mfaLogin');\n\n  if (!assertMaybeEnum(opts, 'initialScreen', screens)) {\n    initialScreen = undefined;\n  }\n\n  if (initialScreen === undefined) {\n    initialScreen = defaults.initialScreen || screens[0];\n  }\n\n  return { initialScreen: initialScreen, screens: new _immutable.List(screens) };\n}\n\nfunction overrideDatabaseOptions(m, opts) {\n  var _processScreenOptions2 = processScreenOptions(opts, {\n    allowLogin: availableScreens(m).contains('login'),\n    allowSignUp: availableScreens(m).contains('signUp'),\n    allowForgotPassword: availableScreens(m).contains('forgotPassword'),\n    initialScreen: get(m, 'initialScreen')\n  }),\n      initialScreen = _processScreenOptions2.initialScreen,\n      screens = _processScreenOptions2.screens;\n\n  m = tset(m, 'initialScreen', initialScreen);\n  m = tset(m, 'screens', screens);\n  return m;\n}\n\nfunction defaultDatabaseConnection(m) {\n  var name = defaultDatabaseConnectionName(m);\n  return name && l.findConnection(m, name);\n}\n\nfunction defaultDatabaseConnectionName(m) {\n  return get(m, 'defaultConnectionName');\n}\n\nfunction databaseConnection(m) {\n  return l.resolvedConnection(m) || (0, _tenant.defaultDirectory)(m) || defaultDatabaseConnection(m) || l.connection(m, 'database');\n}\n\nfunction databaseConnectionName(m) {\n  return (databaseConnection(m) || (0, _immutable.Map)()).get('name');\n}\n\nfunction forgotPasswordLink(m) {\n  var notFound = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n  return get(m, 'forgotPasswordLink', notFound);\n}\n\nfunction signUpLink(m) {\n  var notFound = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n  return get(m, 'signUpLink', notFound);\n}\n\nfunction setScreen(m, name) {\n  var fields = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n  // TODO: the lock/index module should provide a way to clear\n  // everything that needs the be cleared when changing screens, other\n  // modules should not care.\n  m = l.clearGlobalError(m);\n  m = l.clearGlobalSuccess(m);\n  m = (0, _index2.hideInvalidFields)(m, fields);\n  m = (0, _index2.clearFields)(m, fields);\n\n  return tset(m, 'screen', name);\n}\n\nfunction getScreen(m) {\n  var screen = tget(m, 'screen');\n  var initialScreen = getInitialScreen(m);\n  var screens = [screen, initialScreen, 'login', 'signUp', 'forgotPassword', 'mfaLogin'];\n  var availableScreens = screens.filter(function (x) {\n    return hasScreen(m, x);\n  });\n  return availableScreens[0];\n}\n\nfunction availableScreens(m) {\n  return tget(m, 'screens') || get(m, 'screens', new _immutable.List());\n}\n\nfunction getInitialScreen(m) {\n  return tget(m, 'initialScreen') || get(m, 'initialScreen');\n}\n\nfunction hasInitialScreen(m, str) {\n  return getInitialScreen(m) === str;\n}\n\nfunction databaseConnectionRequiresUsername(m) {\n  return (databaseConnection(m) || (0, _immutable.Map)()).toJS().requireUsername;\n}\n\nfunction databaseUsernameStyle(m) {\n  if (l.hasSomeConnections(m, 'database')) {\n    return databaseConnectionRequiresUsername(m) ? get(m, 'usernameStyle', 'any') : 'email';\n  }\n\n  return l.hasSomeConnections(m, 'enterprise') && (0, _enterprise.findADConnectionWithoutDomain)(m) ? 'username' : 'email';\n}\n\nfunction databaseLogInWithEmail(m) {\n  return databaseUsernameStyle(m) === 'email';\n}\n\nfunction databaseUsernameValue(m) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  var isEmailOnly = databaseLogInWithEmail(m);\n  if (isEmailOnly) {\n    return (0, _index2.getFieldValue)(m, 'email');\n  }\n  if (options.emailFirst) {\n    return (0, _index2.getFieldValue)(m, 'email') || (0, _index2.getFieldValue)(m, 'username');\n  }\n  return (0, _index2.getFieldValue)(m, 'username') || (0, _index2.getFieldValue)(m, 'email');\n}\n\nfunction authWithUsername(m) {\n  return databaseConnectionRequiresUsername(m) || get(m, 'usernameStyle', 'email') === 'username';\n}\n\nfunction hasScreen(m, s) {\n  var _toJS = (databaseConnection(m) || (0, _immutable.Map)()).toJS(),\n      allowForgot = _toJS.allowForgot,\n      allowSignup = _toJS.allowSignup;\n\n  return !(allowForgot === false && s === 'forgotPassword') && !(allowSignup === false && s === 'signUp') && availableScreens(m).contains(s);\n}\n\nfunction shouldAutoLogin(m) {\n  return get(m, 'loginAfterSignUp');\n}\n\nfunction passwordStrengthPolicy(m) {\n  return (databaseConnection(m) || (0, _immutable.Map)()).get('passwordPolicy', 'none');\n}\n\nfunction additionalSignUpFields(m) {\n  return get(m, 'additionalSignUpFields', (0, _immutable.List)());\n}\n\nfunction showTerms(m) {\n  return get(m, 'showTerms', true);\n}\n\nfunction mustAcceptTerms(m) {\n  return get(m, 'mustAcceptTerms', false);\n}\n\nfunction termsAccepted(m) {\n  return !mustAcceptTerms(m) || tget(m, 'termsAccepted', false);\n}\n\nfunction toggleTermsAcceptance(m) {\n  return tset(m, 'termsAccepted', !termsAccepted(m));\n}\n\nfunction resolveAdditionalSignUpFields(m) {\n  return additionalSignUpFields(m).reduce(function (r, x) {\n    switch (x.get('type')) {\n      case 'select':\n        return resolveAdditionalSignUpSelectField(r, x);\n      case 'hidden':\n        return resolveAdditionalSignUpHiddenField(r, x);\n      default:\n        return resolveAdditionalSignUpTextField(r, x);\n    }\n  }, m);\n}\n\nfunction resolveAdditionalSignUpSelectField(m, x) {\n  var name = x.get('name');\n  var keyNs = ['additionalSignUpField', name];\n  var prefill = x.get('prefill');\n  var options = x.get('options');\n\n  var resolvedPrefill = typeof prefill === 'function' ? undefined : prefill || '';\n  var resolvedOptions = typeof options === 'function' ? undefined : options;\n\n  var register = function register(m) {\n    return resolvedPrefill !== undefined && resolvedOptions !== undefined ? (0, _index2.registerOptionField)(m, name, _immutable2.default.fromJS(resolvedOptions), resolvedPrefill) : m;\n  };\n\n  if (resolvedPrefill === undefined) {\n    m = (0, _sync2.default)(m, keyNs.concat('prefill'), {\n      recoverResult: '',\n      successFn: function successFn(m, result) {\n        resolvedPrefill = result;\n        return register(m);\n      },\n      syncFn: function syncFn(m, cb) {\n        return prefill(cb);\n      }\n    });\n  }\n\n  if (resolvedOptions === undefined) {\n    m = (0, _sync2.default)(m, keyNs.concat('options'), {\n      successFn: function successFn(m, result) {\n        resolvedOptions = result;\n        return register(m);\n      },\n      syncFn: function syncFn(m, cb) {\n        return options(cb);\n      }\n    });\n  }\n\n  if (resolvedPrefill !== undefined && resolvedOptions !== undefined) {\n    m = (0, _index2.registerOptionField)(m, name, _immutable2.default.fromJS(resolvedOptions), resolvedPrefill);\n  }\n\n  return m;\n}\n\nfunction resolveAdditionalSignUpTextField(m, x) {\n  var name = x.get('name');\n  var key = ['additionalSignUpField', name, 'prefill'];\n  var prefill = x.get('prefill');\n  var validator = x.get('validator');\n\n  var resolvedPrefill = typeof prefill === 'function' ? undefined : prefill || '';\n\n  if (resolvedPrefill === undefined) {\n    m = (0, _sync2.default)(m, key, {\n      recoverResult: '',\n      successFn: function successFn(m, result) {\n        return (0, _index2.setField)(m, name, result, validator);\n      },\n      syncFn: function syncFn(m, cb) {\n        return prefill(cb);\n      }\n    });\n  } else {\n    m = (0, _index2.setField)(m, name, resolvedPrefill, validator);\n  }\n\n  return m;\n}\n\nfunction resolveAdditionalSignUpHiddenField(m, x) {\n  return (0, _index2.setField)(m, x.get('name'), x.get('value'));\n}\n"]},"metadata":{},"sourceType":"script"}